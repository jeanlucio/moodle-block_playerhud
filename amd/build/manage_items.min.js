define("block_playerhud/manage_items",["jquery","core/notification"],(function($,Notification){
/**
   * Manage Items module.
   *
   * @module     block_playerhud/manage_items
   * @copyright  2026 Jean Lúcio
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
return{init:function(config){$("#phAiModal").appendTo("body"),$("#phItemModalView").appendTo("body"),$("#ph-select-all").on("change",(function(){var isChecked=$(this).is(":checked");$(".ph-bulk-check").prop("checked",isChecked).trigger("change")})),$("body").on("change",".ph-bulk-check, #ph-select-all",(function(){var count=$(".ph-bulk-check:checked").length,btn=$("#ph-btn-bulk-delete");if(count>0){btn.removeClass("disabled").removeAttr("disabled");var btnText=config.strings.delete_n_items.replace("%d",count);btn.html('<i class="fa fa-trash"></i> '+btnText)}else btn.addClass("disabled").attr("disabled","disabled"),btn.html('<i class="fa fa-trash"></i> '+config.strings.delete_selected)})),$("#ph-btn-bulk-delete").on("click",(function(e){e.preventDefault(),0!==$(".ph-bulk-check:checked").length&&Notification.confirm(config.strings.confirm_title,config.strings.confirm_bulk,config.strings.yes,config.strings.cancel,(function(){$("#bulk-action-form").submit()}))})),$("body").on("click",".ph-preview-trigger",(function(e){e.preventDefault();var trigger=$(this),name=trigger.attr("data-name"),xp=trigger.attr("data-xp"),img=trigger.attr("data-image"),isImg=trigger.attr("data-isimage"),descTarget=trigger.attr("data-desc-target"),descHtml="";descTarget&&(descHtml=$("#"+descTarget).html()),$("#phModalNameView, #phModalTitleView").text(name),$("#phModalXPView").text(xp);var descEl=$("#phModalDescView");descHtml&&""!==descHtml.trim()?descEl.html(descHtml):descEl.html('<i class="text-muted">'+config.strings.no_desc+"</i>");var imgCont=$("#phModalImageContainerView");imgCont.empty(),"1"===isImg?imgCont.append($("<img>",{src:img,class:"ph-modal-img",alt:"",style:"max-width:100px; max-height:100px; object-fit:contain;"})):imgCont.append($("<span>",{class:"ph-modal-emoji","aria-hidden":"true",style:"font-size:60px; line-height:1;",text:img}));var modalEl=document.getElementById("phItemModalView");"undefined"!=typeof bootstrap&&bootstrap.Modal?bootstrap.Modal.getOrCreateInstance(modalEl).show():$(modalEl).modal("show")})),$("#ai-drop").on("change",(function(){$(this).is(":checked")?$("#ai-drop-options").slideDown():$("#ai-drop-options").slideUp()})),$("body").on("click",".js-delete-btn",(function(e){e.preventDefault();var btn=$(this),targetUrl=btn.attr("href"),msg=btn.attr("data-confirm-msg");Notification.confirm(config.strings.confirm_title,msg,config.strings.yes,config.strings.cancel,(function(){window.location.href=targetUrl}))})),$("#ph-ai-form").on("submit",(function(e){e.preventDefault(),$("#ph-btn-conjure").click()})),$("#ph-btn-conjure").on("click",(function(e){e.preventDefault();var btn=$(this);if(!btn.prop("disabled")){var theme=$("#ai-theme").val(),xp=$("#ai-xp").val(),amount=$("#ai-amount").val()||1,createDrop=$("#ai-drop").is(":checked"),locName=$("#ai-location").val(),maxUsage=$("#ai-maxusage").val(),respawn=$("#ai-respawn").val();if(theme){var originalText=btn.text();btn.prop("disabled",!0).text(config.strings.ai_creating),btn.attr("aria-busy","true"),$.ajax({url:M.cfg.wwwroot+"/blocks/playerhud/ajax_ai.php",method:"POST",dataType:"json",data:{instanceid:config.instanceid,id:config.courseid,theme:theme,xp:xp||0,amount:amount,create_drop:createDrop?1:0,drop_location:locName,drop_max:maxUsage,drop_time:respawn,sesskey:M.cfg.sesskey},success:function(resp){if(btn.prop("disabled",!1).text(originalText).removeAttr("aria-busy"),resp.success){var modalBody=$("#phAiModal .modal-body"),modalFooter=$("#phAiModal .modal-footer"),modalTitle=$("#phAiModalLabel");$("#phAiModal").one("hidden.bs.modal",(function(){window.location.reload()})),modalTitle.text(config.strings.success_title);var successHtml='<div id="ph-success-container" tabindex="-1" class="text-center py-3 animate__animated animate__fadeIn" style="outline: none;">';successHtml+='<div class="mb-3" style="font-size: 3rem; color: #28a745;" aria-hidden="true"><i class="fa fa-check-circle"></i></div>';var itemsList=Array.isArray(resp.created_items)?resp.created_items.join(", "):resp.item_name,count=Array.isArray(resp.created_items)?resp.created_items.length:1;if(successHtml+='<h2 class="fw-bold text-primary mb-3">'+count+"x Itens Criados!</h2>",successHtml+='<p class="text-muted">'+itemsList+"</p>",resp.warning_msg?successHtml+='<div class="alert alert-warning small mb-3"><i class="fa fa-exclamation-triangle"></i> '+resp.warning_msg+"</div>":resp.info_msg&&(successHtml+='<div class="alert alert-success small mb-3"><i class="fa fa-check-circle"></i> '+resp.info_msg+"</div>"),successHtml+='<p class="lead text-muted mb-4">'+config.strings.success+"</p>",1===count&&resp.drop_code){var fullShortcode="[PLAYERHUD_DROP code="+resp.drop_code+"]";successHtml+='<div class="card bg-light border-0 p-3 mx-auto" style="max-width: 90%;">',successHtml+='<label class="small text-muted mb-2 fw-bold text-start w-100" for="ph-gen-code-input">'+config.strings.copy+":</label>",successHtml+='<div class="input-group">',successHtml+='<input type="text" class="form-control font-monospace text-center" value="'+fullShortcode+'" id="ph-gen-code-input" readonly>',successHtml+='<button class="btn btn-primary" type="button" id="ph-btn-copy-code" aria-label="'+config.strings.copy+'"><i class="fa fa-copy" aria-hidden="true"></i></button>',successHtml+="</div></div>"}else count>1&&createDrop&&(successHtml+='<div class="alert alert-info">Os drops foram criados. Use o botão "Gerar Código" na lista para pegar cada um.</div>');successHtml+="</div>",modalBody.html(successHtml);var btnReload=$('<button class="btn btn-success w-100 py-2 fw-bold">'+config.strings.great+"</button>");btnReload.on("click",(function(){window.location.reload()})),modalFooter.empty().append(btnReload),1===count&&resp.drop_code&&setTimeout((function(){$("#ph-btn-copy-code").on("click",(function(){var copyText=document.getElementById("ph-gen-code-input");copyText.select(),copyText.setSelectionRange(0,99999),document.execCommand("copy");var $btn=$(this);$btn.removeClass("btn-primary").addClass("btn-success").html('<i class="fa fa-check" aria-hidden="true"></i>'),setTimeout((function(){$btn.removeClass("btn-success").addClass("btn-primary").html('<i class="fa fa-copy" aria-hidden="true"></i>')}),2e3)})),$("#ph-success-container").focus()}),200)}else Notification.alert("Error",resp.message,"OK")},error:function(xhr,status,error){btn.prop("disabled",!1).text(originalText).removeAttr("aria-busy");var errorMsg=error;if(xhr.responseJSON&&xhr.responseJSON.message)errorMsg=xhr.responseJSON.message;else if(xhr.responseText)try{var r=JSON.parse(xhr.responseText);r.message&&(errorMsg=r.message)}catch(e){}Notification.alert("Ops!",errorMsg,"OK")}})}else Notification.alert("Error",config.strings.err_theme,"OK")}}))}}}));

//# sourceMappingURL=manage_items.min.js.map