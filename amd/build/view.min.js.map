{"version":3,"file":"view.min.js","sources":["../src/view.js"],"sourcesContent":["/* global bootstrap */\n/**\n * Student View JS for PlayerHUD.\n *\n * @module     block_playerhud/view\n * @copyright  2026 Jean Lúcio\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/notification'], function($, Notification) {\n\n    return {\n        /**\n         * Initialize the view script.\n         *\n         * @param {Object} config The configuration object passed from PHP.\n         */\n        init: function(config) {\n            // Move o modal para o final do body para evitar problemas de z-index\n            $('#phItemModalView').appendTo('body');\n\n            // 1. Disable HUD Confirmation.\n            $('.js-disable-hud').on('click', function(e) {\n                e.preventDefault();\n                var url = $(this).attr('href');\n                var msg = $(this).attr('data-confirm-msg');\n\n                Notification.confirm(\n                    config.strings.confirm_title,\n                    msg,\n                    config.strings.yes,\n                    config.strings.cancel,\n                    function() {\n                        window.location.href = url;\n                    }\n                );\n            });\n\n            // Acessibilidade: Permite abrir itens com Enter ou Espaço\n            $(document).on('keydown', '.ph-item-trigger', function(e) {\n                if (e.key === 'Enter' || e.key === ' ') {\n                    e.preventDefault();\n                    $(this).click();\n                }\n            });\n\n            // 2. Item Details Modal Logic.\n            /**\n             * Helper to open/close bootstrap modal safely.\n             */\n            function openItemModal() {\n                var el = document.getElementById('phItemModalView');\n                if (typeof $ !== 'undefined' && $.fn.modal) {\n                    // Bootstrap 4 (Tema Clássico)\n                    $(el).modal('show');\n                } else {\n                    // Bootstrap 5 (Moodle 4.x Padrão)\n                    try {\n                        var m = bootstrap.Modal.getOrCreateInstance(el);\n                        m.show();\n                    } catch (e) {\n                        // eslint-disable-next-line no-console\n                        console.error(e);\n                    }\n                }\n            }\n\n            // Event Delegation for clicking on items.\n            $(document).on('click', '.ph-item-trigger', function(e) {\n                e.preventDefault();\n                var trigger = $(this);\n\n                // Extract data.\n                var name = trigger.attr('data-name');\n                var xp = trigger.attr('data-xp');\n                var img = trigger.attr('data-image');\n                var isImg = trigger.attr('data-isimage'); // String \"1\" or \"0\".\n                var date = trigger.attr('data-date'); // Fallback (Texto do PHP)\n                var timestamp = trigger.attr('data-timestamp'); // Timestamp Cru [NOVO]\n                var count = trigger.attr('data-count');\n                var desc = trigger.find('.ph-item-description-content').html();\n\n                // Populate Modal.\n                $('#phModalTitleView, #phModalNameView').text(name);\n                $('#phModalXPView').text(xp);\n\n                var descEl = $('#phModalDescView');\n                if (desc && desc.trim() !== '') {\n                    descEl.html(desc);\n                } else {\n                    descEl.html('<i class=\"text-muted\">' + config.strings.no_desc + '</i>');\n                }\n\n                var badgeEl = $('#phModalCountBadgeView');\n                if (count && count > 0) {\n                    badgeEl.text('x' + count).show();\n                } else {\n                    badgeEl.hide();\n                }\n\n                // Image Handling (CLEANUP: Classes CSS em vez de style inline)\n                var imgCont = $('#phModalImageContainerView');\n                imgCont.empty();\n\n                if (isImg == '1' || isImg === 'true') {\n                    imgCont.append($('<img>', {\n                        src: img,\n                        'class': 'ph-modal-img ph-img-contain-120',\n                        alt: ''\n                    }));\n                } else {\n                    // Emoji.\n                    imgCont.append($('<span>', {\n                        'class': 'ph-modal-emoji ph-emoji-80',\n                        'aria-hidden': 'true',\n                        text: img\n                    }));\n                }\n\n                // --- Date Internationalization Logic ---\n                var dateEl = $('#phModalDateView');\n                var formattedDate = '';\n\n                if (timestamp && timestamp > 0) {\n                    var lang = $('html').attr('lang') || 'en';\n                    lang = lang.replace('_', '-');\n\n                    try {\n                        formattedDate = new Date(parseInt(timestamp) * 1000).toLocaleDateString(lang, {\n                            day: '2-digit',\n                            month: '2-digit',\n                            year: '2-digit'\n                        });\n                    } catch (err) {\n                        formattedDate = date;\n                    }\n                } else {\n                    formattedDate = date;\n                }\n\n                if (formattedDate) {\n                    var prefix = (config.strings && config.strings.last_collected) ?\n                        config.strings.last_collected + ' ' : '';\n\n                    dateEl.find('span').text(prefix + formattedDate);\n                    dateEl.show();\n                } else {\n                    dateEl.hide();\n                }\n\n                openItemModal();\n            });\n        }\n    };\n});\n"],"names":["define","$","Notification","init","config","appendTo","on","e","preventDefault","url","this","attr","msg","confirm","strings","confirm_title","yes","cancel","window","location","href","document","key","click","trigger","name","xp","img","isImg","date","timestamp","count","desc","find","html","text","descEl","trim","no_desc","badgeEl","show","hide","imgCont","empty","append","src","alt","dateEl","formattedDate","lang","replace","Date","parseInt","toLocaleDateString","day","month","year","err","prefix","last_collected","el","getElementById","fn","modal","bootstrap","Modal","getOrCreateInstance","console","error","openItemModal"],"mappings":";;;;;;;AAQAA,8BAAO,CAAC,SAAU,sBAAsB,SAASC,EAAGC,oBAEzC,CAMHC,KAAM,SAASC,QAEXH,EAAE,oBAAoBI,SAAS,QAG/BJ,EAAE,mBAAmBK,GAAG,SAAS,SAASC,GACtCA,EAAEC,qBACEC,IAAMR,EAAES,MAAMC,KAAK,QACnBC,IAAMX,EAAES,MAAMC,KAAK,oBAEvBT,aAAaW,QACTT,OAAOU,QAAQC,cACfH,IACAR,OAAOU,QAAQE,IACfZ,OAAOU,QAAQG,QACf,WACIC,OAAOC,SAASC,KAAOX,UAMnCR,EAAEoB,UAAUf,GAAG,UAAW,oBAAoB,SAASC,GACrC,UAAVA,EAAEe,KAA6B,MAAVf,EAAEe,MACvBf,EAAEC,iBACFP,EAAES,MAAMa,YA0BhBtB,EAAEoB,UAAUf,GAAG,QAAS,oBAAoB,SAASC,GACjDA,EAAEC,qBACEgB,QAAUvB,EAAES,MAGZe,KAAOD,QAAQb,KAAK,aACpBe,GAAKF,QAAQb,KAAK,WAClBgB,IAAMH,QAAQb,KAAK,cACnBiB,MAAQJ,QAAQb,KAAK,gBACrBkB,KAAOL,QAAQb,KAAK,aACpBmB,UAAYN,QAAQb,KAAK,kBACzBoB,MAAQP,QAAQb,KAAK,cACrBqB,KAAOR,QAAQS,KAAK,gCAAgCC,OAGxDjC,EAAE,uCAAuCkC,KAAKV,MAC9CxB,EAAE,kBAAkBkC,KAAKT,QAErBU,OAASnC,EAAE,oBACX+B,MAAwB,KAAhBA,KAAKK,OACbD,OAAOF,KAAKF,MAEZI,OAAOF,KAAK,yBAA2B9B,OAAOU,QAAQwB,QAAU,YAGhEC,QAAUtC,EAAE,0BACZ8B,OAASA,MAAQ,EACjBQ,QAAQJ,KAAK,IAAMJ,OAAOS,OAE1BD,QAAQE,WAIRC,QAAUzC,EAAE,8BAChByC,QAAQC,QAEK,KAATf,OAA0B,SAAVA,MAChBc,QAAQE,OAAO3C,EAAE,QAAS,CACtB4C,IAAKlB,UACI,kCACTmB,IAAK,MAITJ,QAAQE,OAAO3C,EAAE,SAAU,OACd,2CACM,OACfkC,KAAMR,WAKVoB,OAAS9C,EAAE,oBACX+C,cAAgB,MAEhBlB,WAAaA,UAAY,EAAG,KACxBmB,KAAOhD,EAAE,QAAQU,KAAK,SAAW,KACrCsC,KAAOA,KAAKC,QAAQ,IAAK,SAGrBF,cAAgB,IAAIG,KAA2B,IAAtBC,SAAStB,YAAmBuB,mBAAmBJ,KAAM,CAC1EK,IAAK,UACLC,MAAO,UACPC,KAAM,YAEZ,MAAOC,KACLT,cAAgBnB,WAGpBmB,cAAgBnB,QAGhBmB,cAAe,KACXU,OAAUtD,OAAOU,SAAWV,OAAOU,QAAQ6C,eAC3CvD,OAAOU,QAAQ6C,eAAiB,IAAM,GAE1CZ,OAAOd,KAAK,QAAQE,KAAKuB,OAASV,eAClCD,OAAOP,YAEPO,OAAON,uBAhGPmB,GAAKvC,SAASwC,eAAe,2BAChB,IAAN5D,GAAqBA,EAAE6D,GAAGC,MAEjC9D,EAAE2D,IAAIG,MAAM,iBAIAC,UAAUC,MAAMC,oBAAoBN,IAC1CpB,OACJ,MAAOjC,GAEL4D,QAAQC,MAAM7D,IAwFtB8D"}