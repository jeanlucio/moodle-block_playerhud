{"version":3,"file":"view.min.js","sources":["../src/view.js"],"sourcesContent":["/* global bootstrap */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Student View JS for PlayerHUD.\n *\n * @module     block_playerhud/view\n * @copyright  2026 Jean LÃºcio\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/notification'], function($, Notification) {\n\n    return {\n        /**\n         * Initialize the view script.\n         *\n         * @param {Object} config The configuration object passed from PHP.\n         */\n        init: function(config) {\n            // Move modal to body end to avoid z-index issues.\n            $('#ph-item-modal-view').appendTo('body');\n\n            // 1. Disable HUD Confirmation.\n            $('.js-disable-hud').on('click', function(e) {\n                e.preventDefault();\n                const url = $(this).attr('href');\n                const msg = $(this).attr('data-confirm-msg');\n\n                Notification.confirm(\n                    config.strings.confirm_title,\n                    msg,\n                    config.strings.yes,\n                    config.strings.cancel,\n                    function() {\n                        window.location.href = url;\n                    }\n                );\n            });\n\n            // Accessibility: Allow opening items with Enter or Space.\n            $(document).on('keydown', '.ph-item-trigger', function(e) {\n                if (e.key === 'Enter' || e.key === ' ') {\n                    e.preventDefault();\n                    $(this).click();\n                }\n            });\n\n            // 2. Item Details Modal Logic.\n            /**\n             * Helper to open/close bootstrap modal safely.\n             */\n            const openItemModal = () => {\n                const el = document.getElementById('ph-item-modal-view');\n                    if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {\n                    // Bootstrap 5 (Moodle 4.x Default).\n                    try {\n                        const m = bootstrap.Modal.getOrCreateInstance(el);\n                        m.show();\n                    } catch (e) {\n                        // eslint-disable-next-line no-console\n                        console.error(e);\n                    }\n                } else {\n                    // Fallback for older themes.\n                    $(el).modal('show');\n                }\n            };\n\n            // Event Delegation for clicking on items.\n            $(document).on('click', '.ph-item-trigger', function(e) {\n                e.preventDefault();\n                const trigger = $(this);\n\n                // Extract data.\n                const name = trigger.attr('data-name');\n                const xp = trigger.attr('data-xp');\n                const img = trigger.attr('data-image');\n                const isImg = trigger.attr('data-isimage'); // String \"1\" or \"0\".\n                const date = trigger.attr('data-date'); // Fallback (PHP Text).\n                const timestamp = trigger.attr('data-timestamp'); // Raw Timestamp.\n                const count = trigger.attr('data-count');\n                const desc = trigger.find('.ph-item-description-content').html();\n\n                // Populate Modal.\n                $('#phModalTitleView, #phModalNameView').text(name);\n                $('#phModalXPView').text(xp);\n\n                const descEl = $('#phModalDescView');\n                if (desc && desc.trim() !== '') {\n                    descEl.html(desc);\n                } else {\n                    descEl.html('<i class=\"text-muted\">' + config.strings.no_desc + '</i>');\n                }\n\n                const badgeEl = $('#phModalCountBadgeView');\n                if (count && count > 0) {\n                    badgeEl.text('x' + count).show();\n                } else {\n                    badgeEl.hide();\n                }\n\n                // Image Handling.\n                const imgCont = $('#phModalImageContainerView');\n                imgCont.empty();\n\n                if (isImg == '1' || isImg === 'true') {\n                    imgCont.append($('<img>', {\n                        src: img,\n                        'class': 'ph-modal-img ph-img-contain-120',\n                        alt: ''\n                    }));\n                } else {\n                    // Emoji.\n                    imgCont.append($('<span>', {\n                        'class': 'ph-modal-emoji ph-emoji-80',\n                        'aria-hidden': 'true',\n                        text: img\n                    }));\n                }\n\n                // --- Date Internationalization Logic ---\n                const dateEl = $('#phModalDateView');\n                let formattedDate = '';\n\n                if (timestamp && timestamp > 0) {\n                    let lang = $('html').attr('lang') || 'en';\n                    lang = lang.replace('_', '-');\n\n                    try {\n                        formattedDate = new Date(parseInt(timestamp) * 1000).toLocaleDateString(lang, {\n                            day: '2-digit',\n                            month: '2-digit',\n                            year: '2-digit'\n                        });\n                    } catch (err) {\n                        formattedDate = date;\n                    }\n                } else {\n                    formattedDate = date;\n                }\n\n                if (formattedDate) {\n                    const prefix = (config.strings && config.strings.last_collected) ?\n                        config.strings.last_collected + ' ' : '';\n\n                    dateEl.find('span').text(prefix + formattedDate);\n                    dateEl.show();\n                } else {\n                    dateEl.hide();\n                }\n\n                openItemModal();\n            });\n        }\n    };\n});\n"],"names":["define","$","Notification","init","config","appendTo","on","e","preventDefault","url","this","attr","msg","confirm","strings","confirm_title","yes","cancel","window","location","href","document","key","click","trigger","name","xp","img","isImg","date","timestamp","count","desc","find","html","text","descEl","trim","no_desc","badgeEl","show","hide","imgCont","empty","append","src","alt","dateEl","formattedDate","lang","replace","Date","parseInt","toLocaleDateString","day","month","year","err","prefix","last_collected","el","getElementById","bootstrap","Modal","getOrCreateInstance","console","error","modal","openItemModal"],"mappings":";;;;;;;AAuBAA,8BAAO,CAAC,SAAU,sBAAsB,SAASC,EAAGC,oBAEzC,CAMHC,KAAM,SAASC,QAEXH,EAAE,uBAAuBI,SAAS,QAGlCJ,EAAE,mBAAmBK,GAAG,SAAS,SAASC,GACtCA,EAAEC,uBACIC,IAAMR,EAAES,MAAMC,KAAK,QACnBC,IAAMX,EAAES,MAAMC,KAAK,oBAEzBT,aAAaW,QACTT,OAAOU,QAAQC,cACfH,IACAR,OAAOU,QAAQE,IACfZ,OAAOU,QAAQG,QACf,WACIC,OAAOC,SAASC,KAAOX,UAMnCR,EAAEoB,UAAUf,GAAG,UAAW,oBAAoB,SAASC,GACrC,UAAVA,EAAEe,KAA6B,MAAVf,EAAEe,MACvBf,EAAEC,iBACFP,EAAES,MAAMa,YA0BhBtB,EAAEoB,UAAUf,GAAG,QAAS,oBAAoB,SAASC,GACjDA,EAAEC,uBACIgB,QAAUvB,EAAES,MAGZe,KAAOD,QAAQb,KAAK,aACpBe,GAAKF,QAAQb,KAAK,WAClBgB,IAAMH,QAAQb,KAAK,cACnBiB,MAAQJ,QAAQb,KAAK,gBACrBkB,KAAOL,QAAQb,KAAK,aACpBmB,UAAYN,QAAQb,KAAK,kBACzBoB,MAAQP,QAAQb,KAAK,cACrBqB,KAAOR,QAAQS,KAAK,gCAAgCC,OAG1DjC,EAAE,uCAAuCkC,KAAKV,MAC9CxB,EAAE,kBAAkBkC,KAAKT,UAEnBU,OAASnC,EAAE,oBACb+B,MAAwB,KAAhBA,KAAKK,OACbD,OAAOF,KAAKF,MAEZI,OAAOF,KAAK,yBAA2B9B,OAAOU,QAAQwB,QAAU,cAG9DC,QAAUtC,EAAE,0BACd8B,OAASA,MAAQ,EACjBQ,QAAQJ,KAAK,IAAMJ,OAAOS,OAE1BD,QAAQE,aAINC,QAAUzC,EAAE,8BAClByC,QAAQC,QAEK,KAATf,OAA0B,SAAVA,MAChBc,QAAQE,OAAO3C,EAAE,QAAS,CACtB4C,IAAKlB,UACI,kCACTmB,IAAK,MAITJ,QAAQE,OAAO3C,EAAE,SAAU,OACd,2CACM,OACfkC,KAAMR,aAKRoB,OAAS9C,EAAE,wBACb+C,cAAgB,MAEhBlB,WAAaA,UAAY,EAAG,KACxBmB,KAAOhD,EAAE,QAAQU,KAAK,SAAW,KACrCsC,KAAOA,KAAKC,QAAQ,IAAK,SAGrBF,cAAgB,IAAIG,KAA2B,IAAtBC,SAAStB,YAAmBuB,mBAAmBJ,KAAM,CAC1EK,IAAK,UACLC,MAAO,UACPC,KAAM,YAEZ,MAAOC,KACLT,cAAgBnB,WAGpBmB,cAAgBnB,QAGhBmB,cAAe,OACTU,OAAUtD,OAAOU,SAAWV,OAAOU,QAAQ6C,eAC7CvD,OAAOU,QAAQ6C,eAAiB,IAAM,GAE1CZ,OAAOd,KAAK,QAAQE,KAAKuB,OAASV,eAClCD,OAAOP,YAEPO,OAAON,OAjGO,YACZmB,GAAKvC,SAASwC,eAAe,yBACN,oBAAdC,WAA6BA,UAAUC,UAGpCD,UAAUC,MAAMC,oBAAoBJ,IAC5CpB,OACJ,MAAOjC,GAEL0D,QAAQC,MAAM3D,QAIlBN,EAAE2D,IAAIO,MAAM,SAuFhBC"}