define("block_playerhud/filter_collect",["jquery","core/notification"],(function($,Notification){var restaurar=function(btn,html,mode,width){btn.html(html).removeClass("disabled"),"card"===mode?btn.css("width",width):btn.css("opacity","1").css("pointer-events","auto")};return{init:function(strings){var $modal=$("#phItemModalFilter");$modal.length&&$modal.appendTo("body"),$("body").on("click keydown",".ph-item-details-trigger",(function(e){if("keydown"!==e.type||"Enter"===e.key||" "===e.key){e.preventDefault();var trigger=$(this),container=trigger.closest(".playerhud-item-card, .ph-drop-image-container");0===container.length&&(container=trigger);var name=container.attr("data-name"),descB64=container.attr("data-desc-b64"),img=container.attr("data-image"),isImg=container.attr("data-isimage");$("#phModalTitleF, #phModalNameF").text(name);var descHtml="";try{descHtml=decodeURIComponent(escape(window.atob(descB64)))}catch(err){descHtml="..."}$("#phModalDescF").html(descHtml);var imgCont=$("#phModalImageContainerF");imgCont.empty(),"1"==isImg?imgCont.append($("<img>",{src:img,style:"max-width:80px;"})):imgCont.append($("<span>",{style:"font-size:50px;",text:img}));var modalEl=document.getElementById("phItemModalFilter");modalEl&&("undefined"!=typeof bootstrap&&bootstrap.Modal?bootstrap.Modal.getOrCreateInstance(modalEl).show():$(modalEl).modal("show"))}})),$("body").on("click",".ph-action-collect",(function(e){e.preventDefault();var trigger=$(this),mode=trigger.attr("data-mode")||"card";if(!trigger.hasClass("disabled")&&!trigger.attr("disabled")){var originalHtml=trigger.html(),originalWidth=trigger.css("width");"card"===mode?(trigger.css("width",trigger.outerWidth()+"px"),trigger.html('<i class="fa fa-spinner fa-spin"></i>').addClass("disabled")):trigger.css("opacity","0.5").css("pointer-events","none");var url=trigger.attr("href"),ajaxUrl=url+(-1===url.indexOf("?")?"?":"&")+"ajax=1";$.ajax({url:ajaxUrl,method:"GET",dataType:"json",success:function(resp){if(resp.success){var card=trigger.closest(".playerhud-item-card");if(card.length){var badge=card.find(".ph-badge-count"),currentCount=parseInt(badge.text().replace("x",""),10)||0;badge.text("x"+(currentCount+1)).removeClass("d-none").show()}var hasTimer=resp.cooldown_deadline&&resp.cooldown_deadline>0,isLimit=resp.limit_reached;"text"===mode||"image"===mode?function(trigger,mode,hasTimer,isLimit,resp){if(hasTimer||isLimit)if("text"===mode)trigger.removeAttr("href").removeClass("ph-action-collect"),trigger.addClass("ph-item-details-trigger"),trigger.css("opacity","1").css("pointer-events","auto").css("cursor","pointer"),isLimit?trigger.addClass("text-success").html('<i class="fa fa-check"></i> '+trigger.text()):trigger.addClass("text-muted").html("‚è≥ "+trigger.text()+' <small class="ph-timer" data-deadline="'+resp.cooldown_deadline+'">...</small>');else{var container=trigger.closest(".ph-drop-image-container"),imgWrapper=container.find("> div").first();trigger.remove(),container.addClass("ph-item-details-trigger").attr("tabindex","0").attr("role","button").css("cursor","pointer"),isLimit?(imgWrapper.addClass("ph-state-grayscale"),container.append('<span class="badge bg-success rounded-circle ph-badge-bottom-right"><i class="fa fa-check"></i></span>')):(imgWrapper.addClass("ph-state-dimmed"),container.append('<div class="ph-timer badge bg-light text-dark border shadow-sm ph-badge-bottom-center" data-deadline="'+resp.cooldown_deadline+'" data-no-label="1">...</div>'))}else if("text"===mode){trigger.css("opacity","1").css("pointer-events","auto");var oldColor=trigger.css("color");trigger.css("color","#28a745"),setTimeout((function(){trigger.css("color",oldColor)}),1e3)}else trigger.css("opacity","1").css("pointer-events","auto")}(trigger,mode,hasTimer,isLimit,resp):function(trigger,card,hasTimer,isLimit,resp,strings,originalHtml){if(hasTimer){trigger.removeClass("btn-primary ph-action-collect").removeAttr("href");var tHtml='‚è≥ <span class="ph-timer" data-deadline="'+resp.cooldown_deadline+'">...</span>',tBtn=$('<div class="btn btn-light btn-sm w-100 text-muted" tabindex="0">'+tHtml+"</div>");trigger.replaceWith(tBtn),tBtn.focus()}else isLimit?(trigger.removeClass("btn-primary ph-action-collect").addClass("btn-success disabled").css("cursor","default").removeAttr("href").html('<i class="fa fa-check"></i> '+strings.collected),card.find(".ph-item-details-trigger").focus()):(trigger.removeClass("btn-primary disabled").addClass("btn-success").html('<i class="fa fa-check"></i> '+strings.collected).css("width",""),setTimeout((function(){trigger.removeClass("btn-success").addClass("btn-primary").html(originalHtml),trigger.focus()}),1500))}(trigger,card,hasTimer,isLimit,resp,strings,originalHtml),resp.game_data&&(data=resp.game_data,itemData=resp.item_data,$(".playerhud-widget-container, .block_playerhud_sidebar").each((function(){var container=$(this);container.hasClass("playerhud-widget-container")&&container.removeClass((function(index,className){return(className.match(/(^|\s)ph-lvl-tier-\S+/g)||[]).join(" ")})).addClass(data.level_class);var sidebarGrid=container.find(".ph-sidebar-grid");sidebarGrid.length&&sidebarGrid.removeClass((function(index,className){return(className.match(/(^|\s)ph-lvl-tier-\S+/g)||[]).join(" ")})).addClass(data.level_class);var progressBar=container.find(".progress-bar");progressBar.css("width",data.progress+"%").attr("aria-valuenow",data.progress),progressBar.removeClass((function(index,className){return(className.match(/(^|\s)ph-lvl-tier-\S+/g)||[]).join(" ")})).addClass(data.level_class);var levelBadge=container.find(".badge").filter((function(){return $(this).text().match(/(Level|N√≠vel)/)||$(this).attr("class").match(/ph-lvl-tier-/)}));if(levelBadge.length){levelBadge.removeClass((function(index,className){return(className.match(/(^|\s)ph-lvl-tier-\S+/g)||[]).join(" ")})).addClass(data.level_class);var label=levelBadge.text().indexOf("N√≠vel")>-1?"N√≠vel":"Level",lvlString=data.level;void 0!==data.max_levels&&data.max_levels>0&&(lvlString+="/"+data.max_levels),levelBadge.text(label+" "+lvlString)}container.find("span, div, strong").each((function(){var el=$(this);if(0===el.children().length&&el.text().indexOf("XP")>-1){var xpString=data.currentxp;void 0!==data.xp_target&&data.xp_target>0&&(xpString+=" / "+data.xp_target),xpString+=" XP",data.is_win&&(xpString+=" üèÜ"),el.text(xpString)}}))})),itemData&&$(".ph-sidebar-stash, .ph-widget-stash").each((function(){var stash=$(this),wrapper=stash.closest(".ph-stash-wrapper");wrapper.length&&wrapper.show(),stash.find(".text-muted").remove();var contentHtml="";contentHtml="1"===String(itemData.isimage)?'<img src="'+itemData.image+'" alt="" style="width: 100%; height: 100%; object-fit: contain;">':'<span class="ph-mini-emoji" aria-hidden="true" style="font-size:1.2rem; line-height: 1;">'+itemData.image+"</span>";var newItem=$('<div class="ph-mini-item ph-item-trigger border bg-white rounded d-flex align-items-center justify-content-center overflow-hidden position-relative shadow-sm" role="button" tabindex="0"></div>');newItem.css({width:"34px",height:"34px","min-width":"34px","margin-right":"2px","margin-bottom":"2px"}),newItem.attr("data-name",itemData.name),newItem.attr("data-xp",itemData.xp),newItem.attr("data-image",itemData.image),newItem.attr("data-isimage",itemData.isimage),newItem.attr("data-date",itemData.date),newItem.attr("title",itemData.name),newItem.attr("aria-label",itemData.name),newItem.append('<div class="d-none ph-item-description-content">'+itemData.description+"</div>"),newItem.append(contentHtml),stash.children().filter((function(){return $(this).attr("data-name")===itemData.name})).remove(),newItem.hide(),stash.prepend(newItem),newItem.fadeIn();var limit=stash.hasClass("ph-widget-stash")?14:6,items=stash.children(".ph-mini-item");items.length>limit&&items.last().remove()})))}else restaurar(trigger,originalHtml,mode,originalWidth),Notification.alert("Ops",resp.message,"OK");var data,itemData},error:function(){restaurar(trigger,originalHtml,mode,originalWidth),Notification.alert("Erro",strings.error,"OK")}})}}))}}}));

//# sourceMappingURL=filter_collect.min.js.map