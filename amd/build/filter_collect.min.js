define("block_playerhud/filter_collect",["jquery","core/notification"],(function($,Notification){var restaurar=function(btn,html,mode,width){btn.html(html).removeClass("disabled"),"card"===mode?btn.css("width",width):btn.css("opacity","1").css("pointer-events","auto")},updateHud=function(data,itemData){$(".playerhud-widget-container, .block_playerhud_sidebar").each((function(){var container=$(this);container.hasClass("playerhud-widget-container")&&container.removeClass((function(index,className){return(className.match(/(^|\s)ph-lvl-tier-\S+/g)||[]).join(" ")})).addClass(data.level_class);var sidebarGrid=container.find(".ph-sidebar-grid");sidebarGrid.length&&sidebarGrid.removeClass((function(index,className){return(className.match(/(^|\s)ph-lvl-tier-\S+/g)||[]).join(" ")})).addClass(data.level_class);var progressBar=container.find(".progress-bar");progressBar.css("width",data.progress+"%").attr("aria-valuenow",data.progress),progressBar.removeClass((function(index,className){return(className.match(/(^|\s)ph-lvl-tier-\S+/g)||[]).join(" ")})).addClass(data.level_class);var levelBadge=container.find(".badge").filter((function(){return $(this).text().match(/(Level|N√≠vel)/)||$(this).attr("class").match(/ph-lvl-tier-/)}));if(levelBadge.length){levelBadge.removeClass((function(index,className){return(className.match(/(^|\s)ph-lvl-tier-\S+/g)||[]).join(" ")})).addClass(data.level_class);var label=levelBadge.text().indexOf("N√≠vel")>-1?"N√≠vel":"Level",lvlString=data.level;void 0!==data.max_levels&&data.max_levels>0&&(lvlString+="/"+data.max_levels),levelBadge.text(label+" "+lvlString)}container.find("span, div, strong").each((function(){var el=$(this);if(0===el.children().length&&el.text().indexOf("XP")>-1){var xpString=data.currentxp;void 0!==data.xp_target&&data.xp_target>0&&(xpString+=" / "+data.xp_target),xpString+=" XP",data.is_win&&(xpString+=" üèÜ"),el.text(xpString)}}))})),itemData&&function(itemData){$(".ph-sidebar-stash, .ph-widget-stash").each((function(){var stash=$(this),wrapper=stash.closest(".ph-stash-wrapper");wrapper.length&&wrapper.removeClass("d-none").show(),stash.find(".text-muted").remove(),stash.find("span.small").remove();var contentHtml="";contentHtml="1"===String(itemData.isimage)?'<img src="'+itemData.image+'" alt="" style="width: 100%; height: 100%; object-fit: contain;">':'<span class="ph-mini-emoji" aria-hidden="true" style="font-size:1.2rem; line-height: 1;">'+itemData.image+"</span>";var newItem=$('<div class="ph-mini-item ph-item-trigger border bg-white rounded d-flex align-items-center justify-content-center overflow-hidden position-relative shadow-sm" role="button" tabindex="0"></div>');newItem.css({width:"34px",height:"34px","min-width":"34px","margin-right":"2px","margin-bottom":"2px"}),newItem.attr("data-name",itemData.name),newItem.attr("data-xp",itemData.xp),newItem.attr("data-image",itemData.image),newItem.attr("data-isimage",itemData.isimage),newItem.attr("data-date",itemData.date),itemData.timestamp&&newItem.attr("data-timestamp",itemData.timestamp),newItem.attr("title",itemData.name),newItem.attr("aria-label",itemData.name),newItem.append('<div class="d-none ph-item-description-content">'+(itemData.description||"")+"</div>"),newItem.append(contentHtml),stash.children().filter((function(){return $(this).attr("data-name")===itemData.name})).remove(),newItem.hide(),stash.prepend(newItem),newItem.fadeIn();var limit=stash.hasClass("ph-widget-stash")?14:6,items=stash.children(".ph-mini-item");items.length>limit&&items.last().remove()}))}(itemData)};return{init:function(strings){var $filterModal=$("#phItemModalFilter");$filterModal.length&&$filterModal.appendTo("body"),$("body").on("click keydown",".ph-item-details-trigger",(function(e){if("keydown"!==e.type||"Enter"===e.key||" "===e.key){e.preventDefault();var trigger=$(this),container=trigger.closest(".playerhud-item-card, .ph-drop-image-container, .ph-mini-item");0===container.length&&(container=trigger);var root,suffix,name=container.attr("data-name"),descB64=container.attr("data-desc-b64"),descDirect=container.find(".ph-item-description-content").html(),img=container.attr("data-image"),isImg=container.attr("data-isimage"),xp=container.attr("data-xp"),date=container.attr("data-date"),timestamp=container.attr("data-timestamp"),modalEls=(root=$("#phItemModalView"),suffix="View",root.length||(root=$("#phItemModalFilter"),suffix="F"),{root:root,title:$("#phModalTitle"+suffix),name:$("#phModalName"+suffix),desc:$("#phModalDesc"+suffix),imgContainer:$("#phModalImageContainer"+suffix),xp:$("#phModalXP"+suffix),countBadge:$("#phModalCountBadge"+suffix),date:$("#phModalDate"+suffix),dateContainer:$("#phModalDateContainer"+suffix)});if(modalEls.root.length){if(modalEls.title.text(name),modalEls.name.text(name),xp&&"0"!==xp&&-1===xp.indexOf("???")){var xpText=$.isNumeric(xp)?xp+" XP":xp;modalEls.xp.text(xpText).removeClass("d-none").show()}else modalEls.xp.hide();modalEls.countBadge&&modalEls.countBadge.length&&modalEls.countBadge.hide();var descHtml="...";if(descDirect)descHtml=descDirect;else if(descB64)try{descHtml=decodeURIComponent(escape(window.atob(descB64)))}catch(err){descHtml="..."}modalEls.desc.html(descHtml);var dateEl="phItemModalView"===modalEls.root.attr("id")?modalEls.date:$("#phModalDateF"),dateContainer="phItemModalView"===modalEls.root.attr("id")?modalEls.date:modalEls.dateContainer,formattedDate="";if(timestamp&&timestamp>0){var lang=$("html").attr("lang")||"en";lang=lang.replace("_","-");try{formattedDate=new Date(1e3*parseInt(timestamp)).toLocaleDateString(lang,{day:"2-digit",month:"2-digit",year:"2-digit"})}catch(err){formattedDate=date}}else formattedDate=date;if(formattedDate){var prefix=strings.last_collected?strings.last_collected+" ":"";"phItemModalView"!==modalEls.root.attr("id")?(dateEl.text(prefix+formattedDate),dateContainer&&dateContainer.removeClass("d-none")):(dateEl.find("span").text(prefix+formattedDate),dateEl.show())}else"phItemModalView"!==modalEls.root.attr("id")?dateContainer&&dateContainer.addClass("d-none"):dateEl.hide();modalEls.imgContainer.empty(),"1"==isImg?modalEls.imgContainer.append($("<img>",{src:img,class:"ph-modal-img",alt:""})):modalEls.imgContainer.append($("<span>",{class:"ph-modal-emoji","aria-hidden":"true",text:img}));var modalEl=modalEls.root[0];"undefined"!=typeof bootstrap&&bootstrap.Modal?bootstrap.Modal.getOrCreateInstance(modalEl).show():modalEls.root.modal("show")}}})),$("body").on("click",".ph-action-collect",(function(e){e.preventDefault();var trigger=$(this),mode=trigger.attr("data-mode")||"card";if(!trigger.hasClass("disabled")&&!trigger.attr("disabled")){var originalHtml=trigger.html(),originalWidth=trigger.css("width");"card"===mode?(trigger.css("width",trigger.outerWidth()+"px"),trigger.html('<i class="fa fa-spinner fa-spin"></i>').addClass("disabled")):trigger.css("opacity","0.5").css("pointer-events","none");var url=trigger.attr("href"),ajaxUrl=url+(-1===url.indexOf("?")?"?":"&")+"ajax=1";$.ajax({url:ajaxUrl,method:"GET",dataType:"json",success:function(resp){if(resp.success){var serverDate=resp.item_data&&resp.item_data.date?resp.item_data.date:"",serverTs=resp.item_data&&resp.item_data.timestamp?resp.item_data.timestamp:0,card=trigger.closest(".playerhud-item-card");if(card.length){var badge=card.find(".ph-badge-count");if(!("1"===card.attr("data-unique"))){var currentCount=parseInt(badge.text().replace("x",""),10)||0;badge.text("x"+(currentCount+1)).removeClass("d-none").show()}card.attr("data-date",serverDate),card.attr("data-timestamp",serverTs)}if("image"===mode){var imgContainer=trigger.closest(".ph-drop-image-container");imgContainer.attr("data-date",serverDate),imgContainer.attr("data-timestamp",serverTs)}var hasTimer=resp.cooldown_deadline&&resp.cooldown_deadline>0,isLimit=resp.limit_reached;"text"===mode||"image"===mode?function(trigger,mode,hasTimer,isLimit,resp){if(hasTimer||isLimit)if("text"===mode)trigger.removeAttr("href").removeClass("ph-action-collect"),trigger.addClass("ph-item-details-trigger"),trigger.css("opacity","1").css("pointer-events","auto").css("cursor","pointer"),isLimit?trigger.addClass("text-success fw-bold").html('<i class="fa fa-check" aria-hidden="true"></i> '+trigger.text()):trigger.addClass("ph-text-dimmed").html('<span aria-hidden="true">‚è≥</span> '+trigger.text()+' <small class="ph-timer" data-deadline="'+resp.cooldown_deadline+'">...</small>');else{var container=trigger.closest(".ph-drop-image-container"),imgWrapper=container.find("> div").first();trigger.remove(),container.addClass("ph-item-details-trigger").attr("tabindex","0").attr("role","button").css("cursor","pointer"),isLimit?(imgWrapper.addClass("ph-state-grayscale"),container.append('<span class="badge bg-success rounded-circle ph-badge-bottom-right"><i class="fa fa-check" aria-hidden="true"></i></span>')):(imgWrapper.addClass("ph-state-dimmed"),container.append('<div class="ph-timer badge bg-light text-dark border shadow-sm ph-badge-bottom-center" data-deadline="'+resp.cooldown_deadline+'" data-no-label="1">...</div>'))}else if("text"===mode){trigger.css("opacity","1").css("pointer-events","auto");var oldColor=trigger.css("color");trigger.css("color","#198754"),setTimeout((function(){trigger.css("color",oldColor)}),1e3)}else trigger.css("opacity","1").css("pointer-events","auto")}(trigger,mode,hasTimer,isLimit,resp):function(trigger,card,hasTimer,isLimit,resp,strings,originalHtml){if(hasTimer){trigger.removeClass("btn-primary ph-action-collect").removeAttr("href");var tHtml='‚è≥ <span class="ph-timer" data-deadline="'+resp.cooldown_deadline+'">...</span>',tBtn=$('<div class="btn btn-light btn-sm w-100 ph-text-dimmed" tabindex="0">'+tHtml+"</div>");trigger.replaceWith(tBtn),tBtn.focus()}else isLimit?(trigger.removeClass("btn-primary ph-action-collect").addClass("btn-light text-success disabled border-success").css("cursor","default").removeAttr("href").html('<i class="fa fa-check" aria-hidden="true"></i> '+strings.collected),card.find(".ph-item-details-trigger").focus()):(trigger.removeClass("btn-primary disabled").addClass("btn-success").html('<i class="fa fa-check" aria-hidden="true"></i> '+strings.collected).css("width",""),setTimeout((function(){trigger.removeClass("btn-success").addClass("btn-primary").html(originalHtml),trigger.focus()}),1500))}(trigger,card,hasTimer,isLimit,resp,strings,originalHtml),resp.game_data&&updateHud(resp.game_data,resp.item_data)}else restaurar(trigger,originalHtml,mode,originalWidth),Notification.alert("Ops",resp.message,"OK")},error:function(){restaurar(trigger,originalHtml,mode,originalWidth),Notification.alert("Erro",strings.error,"OK")}})}}))}}}));

//# sourceMappingURL=filter_collect.min.js.map