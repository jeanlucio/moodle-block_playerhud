define("block_playerhud/filter_collect",["jquery","core/notification"],(function($,Notification){var restaurar=function(btn,html,mode,width){btn.html(html).removeClass("disabled"),"card"===mode?btn.css("width",width):btn.css("opacity","1").css("pointer-events","auto")};return{init:function(strings){var $modal=$("#phItemModalFilter");$modal.length&&$modal.appendTo("body"),$("body").on("click keydown",".ph-item-details-trigger",(function(e){if("keydown"!==e.type||"Enter"===e.key||" "===e.key){e.preventDefault();var trigger=$(this),container=trigger.closest(".playerhud-item-card");0===container.length&&(container=trigger);var name=container.attr("data-name"),descB64=container.attr("data-desc-b64"),img=container.attr("data-image"),isImg=container.attr("data-isimage");$("#phModalTitleF, #phModalNameF").text(name);var descHtml="";try{descHtml=decodeURIComponent(escape(window.atob(descB64)))}catch(err){descHtml="..."}$("#phModalDescF").html(descHtml);var imgCont=$("#phModalImageContainerF");imgCont.empty(),"1"==isImg?imgCont.append($("<img>",{src:img,style:"max-width:80px;"})):imgCont.append($("<span>",{style:"font-size:50px;",text:img}));var modalEl=document.getElementById("phItemModalFilter");modalEl&&("undefined"!=typeof bootstrap&&bootstrap.Modal?bootstrap.Modal.getOrCreateInstance(modalEl).show():$(modalEl).modal("show"))}})),$("body").on("click",".ph-action-collect",(function(e){e.preventDefault();var trigger=$(this),mode=trigger.attr("data-mode")||"card";if(!trigger.hasClass("disabled")&&!trigger.attr("disabled")){var originalHtml=trigger.html(),originalWidth=trigger.css("width");"card"===mode?(trigger.css("width",trigger.outerWidth()+"px"),trigger.html('<i class="fa fa-spinner fa-spin"></i>').addClass("disabled")):trigger.css("opacity","0.5").css("pointer-events","none");var url=trigger.attr("href"),ajaxUrl=url+(-1===url.indexOf("?")?"?":"&")+"ajax=1";$.ajax({url:ajaxUrl,method:"GET",dataType:"json",success:function(resp){if(resp.success){var card=trigger.closest(".playerhud-item-card");if(card.length){var badge=card.find(".ph-badge-count"),currentCount=parseInt(badge.text().replace("x",""),10)||0;badge.text("x"+(currentCount+1)).show()}var hasTimer=resp.cooldown_deadline&&resp.cooldown_deadline>0,isLimit=resp.limit_reached;"text"===mode||"image"===mode?function(trigger,mode,hasTimer,isLimit,resp){if(hasTimer||isLimit)trigger.removeAttr("href").removeClass("ph-action-collect"),trigger.addClass("ph-item-details-trigger"),trigger.css("opacity","1").css("pointer-events","auto").css("cursor","pointer"),"text"===mode?isLimit?trigger.addClass("text-success").html('<i class="fa fa-check"></i> '+trigger.text()):trigger.addClass("text-muted").html("⏳ "+trigger.text()+' <small class="ph-timer" data-deadline="'+resp.cooldown_deadline+'">...</small>'):isLimit?(trigger.css("position","relative"),trigger.append('<span class="badge bg-success rounded-circle" style="position:absolute; bottom:-5px; right:-5px; font-size:0.6rem;"><i class="fa fa-check"></i></span>'),trigger.find("img, span").css("filter","grayscale(100%)").css("opacity","0.6")):(trigger.css("position","relative"),trigger.find("img, span").css("opacity","0.6"),trigger.append('<div class="ph-timer badge bg-light text-dark border shadow-sm" style="position:absolute; bottom:-10px; left:50%; transform:translateX(-50%); font-size:0.6rem;" data-deadline="'+resp.cooldown_deadline+'">...</div>'));else{trigger.css("opacity","1").css("pointer-events","auto");var oldColor=trigger.css("color");trigger.css("color","#28a745"),setTimeout((function(){trigger.css("color",oldColor)}),1e3)}}(trigger,mode,hasTimer,isLimit,resp):function(trigger,card,hasTimer,isLimit,resp,strings,originalHtml){if(hasTimer){trigger.removeClass("btn-primary ph-action-collect").removeAttr("href");var tHtml='⏳ <span class="ph-timer" data-deadline="'+resp.cooldown_deadline+'">...</span>',tBtn=$('<div class="btn btn-light btn-sm w-100 text-muted" tabindex="0">'+tHtml+"</div>");trigger.replaceWith(tBtn),tBtn.focus()}else isLimit?(trigger.removeClass("btn-primary ph-action-collect").addClass("btn-success disabled").css("cursor","default").removeAttr("href").html('<i class="fa fa-check"></i> '+strings.collected),card.find(".ph-item-details-trigger").focus()):(trigger.removeClass("btn-primary disabled").addClass("btn-success").html('<i class="fa fa-check"></i> '+strings.collected).css("width",""),setTimeout((function(){trigger.removeClass("btn-success").addClass("btn-primary").html(originalHtml),trigger.focus()}),1500))}(trigger,card,hasTimer,isLimit,resp,strings,originalHtml),resp.game_data&&function(data,itemData){var widget=$(".playerhud-widget-container");widget.length&&widget.find(".progress-bar").css("width",data.progress+"%");var sidebar=$(".block_playerhud_sidebar");if(sidebar.length&&(sidebar.find(".progress-bar").css("width",data.progress+"%").attr("aria-valuenow",data.progress),sidebar.find("span").each((function(){var txt=$(this).text();if(txt.indexOf("XP")>-1&&$(this).text(data.currentxp+" XP"),txt.indexOf("Level")>-1||txt.indexOf("Nível")>-1){var prefix=txt.split(" ")[0];$(this).text(prefix+" "+data.level)}})),itemData)){var wrapper=sidebar.find(".ph-stash-wrapper"),stash=sidebar.find(".ph-sidebar-stash");wrapper.show();var contentHtml="";contentHtml=1==itemData.isimage?'<img src="'+itemData.image+'" alt="'+itemData.name+'">':'<span class="ph-mini-emoji" aria-hidden="true">'+itemData.image+"</span>";var newItem=$('<div class="ph-mini-item ph-item-trigger" role="button" tabindex="0"></div>');newItem.attr("data-name",itemData.name),newItem.attr("data-xp",itemData.xp),newItem.attr("data-image",itemData.image),newItem.attr("data-isimage",itemData.isimage),newItem.attr("data-date",itemData.date),newItem.attr("title",itemData.name),newItem.append('<div class="d-none ph-item-description-content">'+itemData.description+"</div>"),newItem.append(contentHtml),stash.children().filter((function(){return $(this).attr("data-name")===itemData.name})).remove(),newItem.hide(),stash.prepend(newItem),newItem.fadeIn();var items=stash.children(".ph-mini-item");items.length>6&&items.last().remove()}}(resp.game_data,resp.item_data)}else restaurar(trigger,originalHtml,mode,originalWidth),Notification.alert("Ops",resp.message,"OK")},error:function(){restaurar(trigger,originalHtml,mode,originalWidth),Notification.alert("Erro",strings.error,"OK")}})}}))}}}));

//# sourceMappingURL=filter_collect.min.js.map