{"version":3,"file":"filter_collect.min.js","sources":["../src/filter_collect.js"],"sourcesContent":["/* global bootstrap */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Collect items via Filter Shortcodes.\n *\n * @module     block_playerhud/filter_collect\n * @copyright  2026 Jean L√∫cio\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Notification from 'core/notification';\nimport Ajax from 'core/ajax';\nimport Str from 'core/str';\n\n/**\n * Globals to hold config strings.\n */\nlet appStrings = {};\n\n/**\n * Get modal elements ensuring reusability.\n *\n * @return {Object} jQuery objects for modal elements.\n */\nconst getModalElements = () => {\n    let root = $('#phItemModalView');\n    let suffix = 'View';\n\n    if (!root.length) {\n        root = $('#phItemModalFilter');\n        suffix = 'F';\n    }\n\n    return {\n        root: root,\n        title: $(`#phModalTitle${suffix}`),\n        name: $(`#phModalName${suffix}`),\n        desc: $(`#phModalDesc${suffix}`),\n        imgContainer: $(`#phModalImageContainer${suffix}`),\n        xp: $(`#phModalXP${suffix}`),\n        countBadge: $(`#phModalCountBadge${suffix}`),\n        date: $(`#phModalDate${suffix}`),\n        dateContainer: $(`#phModalDateContainer${suffix}`)\n    };\n};\n\n/**\n * Updates the stash (recent items) in the sidebar.\n *\n * @param {Object} itemData\n */\nconst updateStash = (itemData) => {\n    const stashes = $('.ph-sidebar-stash, .ph-widget-stash');\n\n    stashes.each(function() {\n        const stash = $(this);\n        stash.closest('.ph-stash-wrapper').removeClass('d-none').show();\n        stash.find('.text-muted, span.small').remove();\n\n        // Check for duplicate items by name and remove them.\n        stash.children().filter((i, el) => $(el).attr('data-name') === itemData.name).remove();\n\n        const isImage = String(itemData.isimage) === '1';\n        let contentHtml = '';\n\n        if (isImage) {\n            contentHtml = `<img src=\"${itemData.image}\" alt=\"\" class=\"ph-mini-item-img\">`;\n        } else {\n            contentHtml = `<span class=\"ph-mini-emoji\" aria-hidden=\"true\">${itemData.image}</span>`;\n        }\n\n        const newItem = $('<div>', {\n            'class': 'ph-mini-item ph-item-trigger border bg-white rounded ' +\n                     'd-flex align-items-center justify-content-center overflow-hidden position-relative shadow-sm',\n            'role': 'button',\n            'tabindex': '0',\n            'data-name': itemData.name,\n            'data-xp': itemData.xp,\n            'data-image': itemData.image,\n            'data-isimage': itemData.isimage,\n            'data-date': itemData.date,\n            'data-timestamp': itemData.timestamp || 0,\n            'title': itemData.name,\n            'aria-label': itemData.name\n        });\n\n        newItem.append(`<div class=\"d-none ph-item-description-content\">${itemData.description || ''}</div>`);\n        newItem.append(contentHtml);\n\n        newItem.hide().prependTo(stash).fadeIn();\n\n        // Limit items in stash (Widget vs Sidebar).\n        const limit = stash.hasClass('ph-widget-stash') ? 14 : 6;\n        if (stash.children('.ph-mini-item').length > limit) {\n            stash.children('.ph-mini-item').last().remove();\n        }\n    });\n};\n\n/**\n * Updates the Player HUD sidebar with new stats.\n *\n * @param {Object} data Game data from server.\n * @param {Object|null} itemData Collected item data.\n */\nconst updateHud = (data, itemData) => {\n    const containers = $('.playerhud-widget-container, .block_playerhud_sidebar');\n\n    containers.each(function() {\n        const container = $(this);\n\n        // Update Level Classes.\n        const tierRegex = /(^|\\s)ph-lvl-tier-\\S+/g;\n        const removeTierClasses = (idx, className) => (className.match(tierRegex) || []).join(' ');\n\n        if (container.hasClass('playerhud-widget-container')) {\n            container.removeClass(removeTierClasses).addClass(data.level_class);\n        }\n\n        container.find('.ph-sidebar-grid, .progress-bar, .badge').each(function() {\n            $(this).removeClass(removeTierClasses).addClass(data.level_class);\n        });\n\n        // Update Progress Bar.\n        const progressBar = container.find('.progress-bar');\n        progressBar.css('width', `${data.progress}%`).attr('aria-valuenow', data.progress);\n\n        // Update Level Badge.\n        const levelBadge = container.find('.badge').filter(function() {\n            return $(this).attr('class').match(/ph-lvl-tier-/);\n        });\n\n        if (levelBadge.length) {\n            const labelText = appStrings.level || 'Level';\n            let lvlString = `${data.level}`;\n            if (data.max_levels > 0) {\n                lvlString += `/${data.max_levels}`;\n            }\n            levelBadge.text(`${labelText} ${lvlString}`);\n        }\n\n        // Update XP Text.\n        container.find('span, div, strong').each(function() {\n            const el = $(this);\n            if (el.children().length === 0 && el.text().indexOf('XP') > -1) {\n                let xpString = `${data.currentxp}`;\n                if (data.xp_target > 0) {\n                    xpString += ` / ${data.xp_target}`;\n                }\n                xpString += ' XP';\n                if (data.is_win) {\n                    xpString += ' üèÜ';\n                }\n                el.text(xpString);\n            }\n        });\n    });\n\n    if (itemData) {\n        updateStash(itemData);\n    }\n};\n\n/**\n * Handles the collection button loading state.\n *\n * @param {Object} trigger jQuery element.\n * @param {Boolean} isLoading\n * @param {String} originalHtml\n */\nconst toggleLoading = (trigger, isLoading, originalHtml = '') => {\n    const mode = trigger.attr('data-mode') || 'card';\n\n    if (isLoading) {\n        trigger.addClass('disabled').attr('aria-disabled', 'true');\n        if (mode === 'card') {\n            trigger.css('width', trigger.outerWidth() + 'px');\n            trigger.html('<i class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></i>');\n        } else {\n            trigger.addClass('ph-opacity-50').css('pointer-events', 'none');\n        }\n    } else {\n        trigger.removeClass('disabled').removeAttr('aria-disabled');\n        if (mode === 'card') {\n            trigger.css('width', '');\n            trigger.html(originalHtml);\n        } else {\n            trigger.removeClass('ph-opacity-50').css('pointer-events', 'auto');\n        }\n    }\n};\n\n/**\n * Updates UI for Text or Image mode.\n *\n * @param {Object} trigger The jQuery element.\n * @param {String} mode 'text' or 'image'.\n * @param {Boolean} hasTimer If has cooldown.\n * @param {Boolean} isLimit If limit reached.\n * @param {Object} resp Response data.\n */\nconst updateTextOrImageUi = (trigger, mode, hasTimer, isLimit, resp) => {\n    trigger.removeClass('disabled ph-opacity-50').removeAttr('aria-disabled').css('pointer-events', 'auto');\n\n    if (hasTimer || isLimit) {\n        if (mode === 'text') {\n            trigger.removeAttr('href').removeClass('ph-action-collect').addClass('ph-item-details-trigger');\n            trigger.css({'cursor': 'pointer', 'pointer-events': 'auto', 'opacity': '1'});\n\n            if (isLimit) {\n                trigger.addClass('text-success fw-bold')\n                    .html(`<i class=\"fa fa-check\" aria-hidden=\"true\"></i> ${trigger.text()}`);\n            } else {\n                trigger.addClass('ph-text-dimmed')\n                    .html(`<span aria-hidden=\"true\">‚è≥</span> ${trigger.text()} ` +\n                          `<small class=\"ph-timer\" data-deadline=\"${resp.cooldown_deadline}\">...</small>`);\n            }\n        } else {\n            const container = trigger.closest('.ph-drop-image-container');\n            const imgWrapper = container.find('> div').first();\n            trigger.remove();\n\n            container.addClass('ph-item-details-trigger ph-cursor-pointer')\n                     .attr({'tabindex': '0', 'role': 'button'});\n\n            if (isLimit) {\n                imgWrapper.addClass('ph-state-grayscale');\n                container.append('<span class=\"badge bg-success rounded-circle ph-badge-bottom-right\">' +\n                    '<i class=\"fa fa-check\" aria-hidden=\"true\"></i></span>');\n            } else {\n                imgWrapper.addClass('ph-state-dimmed');\n                container.append(`<div class=\"ph-timer badge bg-light text-dark border shadow-sm ph-badge-bottom-center\"\n                    data-deadline=\"${resp.cooldown_deadline}\" data-no-label=\"1\">...</div>`);\n            }\n        }\n    } else if (mode === 'text') {\n        const oldColor = trigger.css('color');\n        trigger.css('color', '#198754');\n        setTimeout(() => trigger.css('color', oldColor), 1000);\n    }\n};\n\n/**\n * Updates UI for Card mode.\n *\n * @param {Object} trigger The jQuery element.\n * @param {Boolean} hasTimer If has cooldown.\n * @param {Boolean} isLimit If limit reached.\n * @param {Object} resp Response data.\n * @param {String} originalHtml Original button HTML.\n */\nconst updateCardUi = (trigger, hasTimer, isLimit, resp, originalHtml) => {\n    if (hasTimer) {\n        trigger.removeClass('btn-primary ph-action-collect').removeAttr('href');\n        const tHtml = `‚è≥ <span class=\"ph-timer\" data-deadline=\"${resp.cooldown_deadline}\">...</span>`;\n        const tBtn = $(`<div class=\"btn btn-light btn-sm w-100 ph-text-dimmed\" tabindex=\"0\">${tHtml}</div>`);\n        trigger.replaceWith(tBtn);\n        tBtn.focus();\n    } else if (isLimit) {\n        const collectedText = appStrings.collected || 'Collected';\n        trigger.removeClass('btn-primary ph-action-collect')\n            .addClass('btn-light text-success disabled border-success')\n            .css('cursor', 'default').removeAttr('href')\n            .html(`<i class=\"fa fa-check\" aria-hidden=\"true\"></i> ${collectedText}`);\n        trigger.closest('.playerhud-item-card').find('.ph-item-details-trigger').focus();\n    } else {\n        const collectedText = appStrings.collected || 'Collected';\n        trigger.removeClass('btn-primary disabled').addClass('btn-success')\n            .html(`<i class=\"fa fa-check\" aria-hidden=\"true\"></i> ${collectedText}`).css('width', '');\n\n        setTimeout(() => {\n            trigger.removeClass('btn-success').addClass('btn-primary').html(originalHtml);\n            trigger.removeAttr('aria-disabled');\n            trigger.focus();\n        }, 1500);\n    }\n};\n\n/**\n * Process the collection result UI updates (Orchestrator).\n *\n * @param {Object} trigger The jQuery element.\n * @param {Object} resp The ajax response.\n * @param {String} originalHtml The original HTML.\n * @param {Object} strings Localized strings.\n */\nconst handleCollectionSuccess = (trigger, resp, originalHtml, strings) => {\n    const mode = trigger.attr('data-mode') || 'card';\n    const hasTimer = (resp.cooldown_deadline && resp.cooldown_deadline > 0);\n    const isLimit = resp.limit_reached;\n\n    if (resp.item_data) {\n        const card = trigger.closest('.playerhud-item-card');\n        if (card.length) {\n            const badge = card.find('.ph-badge-count');\n            if (card.attr('data-unique') !== '1') {\n                const currentCount = parseInt(badge.text().replace('x', ''), 10) || 0;\n                badge.text('x' + (currentCount + 1)).removeClass('d-none').show();\n            }\n            card.attr('data-date', resp.item_data.date);\n            card.attr('data-timestamp', resp.item_data.timestamp);\n\n            // Update XP attribute in DOM so modal reads the new value.\n            card.attr('data-xp', resp.item_data.xp);\n        }\n\n        if (mode === 'image') {\n            trigger.closest('.ph-drop-image-container').attr({\n                'data-date': resp.item_data.date,\n                'data-timestamp': resp.item_data.timestamp,\n                'data-xp': resp.item_data.xp\n            });\n        }\n    }\n\n    if (mode === 'text' || mode === 'image') {\n        updateTextOrImageUi(trigger, mode, hasTimer, isLimit, resp);\n    } else {\n        updateCardUi(trigger, hasTimer, isLimit, resp, originalHtml, strings);\n    }\n\n    if (resp.game_data) {\n        updateHud(resp.game_data, resp.item_data);\n    }\n};\n\n/**\n * Helper to safely decode Base64 UTF-8 strings.\n *\n * @param {String} str Base64 string\n * @return {String} Decoded string\n */\nconst safeB64Decode = (str) => {\n    try {\n        const binString = window.atob(str);\n        const bytes = Uint8Array.from(binString, (m) => m.codePointAt(0));\n        return new TextDecoder().decode(bytes);\n    } catch (e) {\n        return '';\n    }\n};\n\n/**\n * Initialize.\n *\n * @param {Object} config Configuration object passed from PHP.\n */\nexport const init = (config) => {\n    appStrings = config.strings || {};\n\n    const $filterModal = $('#phItemModalFilter');\n    if ($filterModal.length) {\n        $filterModal.appendTo('body');\n    }\n\n    $('body').on('click', '.js-disable-hud', function(e) {\n        e.preventDefault();\n        const url = $(this).attr('href');\n        const msg = $(this).attr('data-confirm-msg');\n\n        Notification.confirm(\n            appStrings.confirm_title,\n            msg,\n            appStrings.yes,\n            appStrings.cancel,\n            () => {\n                window.location.href = url;\n            }\n        );\n    });\n\n    // Item Details Modal.\n    // eslint-disable-next-line complexity\n    $('body').on('click keydown', '.ph-item-details-trigger', function(e) {\n        if (e.type === 'keydown' && e.key !== 'Enter' && e.key !== ' ') {\n            return;\n        }\n        e.preventDefault();\n\n        const trigger = $(this);\n        let container = trigger.closest('.playerhud-item-card, .ph-drop-image-container, .ph-mini-item');\n        if (!container.length) {\n            container = trigger;\n        }\n\n        const data = {\n            name: container.attr('data-name'),\n            descB64: container.attr('data-desc-b64'),\n            descDirect: container.find('.ph-item-description-content').html(),\n            img: container.attr('data-image'),\n            isImg: container.attr('data-isimage'),\n            xp: container.attr('data-xp'),\n            date: container.attr('data-date'),\n            timestamp: container.attr('data-timestamp')\n        };\n\n        const modalEls = getModalElements();\n        if (!modalEls.root.length) {\n            return;\n        }\n\n        modalEls.title.text(data.name);\n        modalEls.name.text(data.name);\n\n        if (data.xp && data.xp !== '0') {\n            const xpStr = String(data.xp);\n            if (xpStr.indexOf('???') === -1) {\n                const isNum = !isNaN(parseFloat(data.xp)) && isFinite(data.xp);\n                // Ensure text contains \" XP\" if it is just a number.\n                const xpText = isNum ? `${data.xp} XP` : data.xp;\n\n                modalEls.xp.text(xpText).removeClass('d-none').show();\n\n                // Force blue color (bg-primary) in filter modal, removing old styles.\n                modalEls.xp.removeClass('ph-bg-teal bg-info text-dark').addClass('bg-primary text-white');\n            } else {\n                modalEls.xp.hide();\n            }\n        } else {\n            modalEls.xp.hide();\n        }\n\n        if (modalEls.countBadge.length) {\n            modalEls.countBadge.hide();\n        }\n\n        let descHtml = '...';\n        if (data.descDirect) {\n            descHtml = data.descDirect;\n        } else if (data.descB64) {\n            descHtml = safeB64Decode(data.descB64);\n        }\n        modalEls.desc.html(descHtml);\n\n        let formattedDate = data.date;\n        if (data.timestamp && data.timestamp > 0) {\n            const lang = $('html').attr('lang').replace('_', '-') || 'en';\n            try {\n                formattedDate = new Date(parseInt(data.timestamp) * 1000).toLocaleDateString(lang, {\n                    day: '2-digit', month: '2-digit', year: '2-digit'\n                });\n            } catch (err) { /* Ignore */ }\n        }\n\n        if (formattedDate) {\n            const prefix = appStrings.last_collected ? `${appStrings.last_collected} ` : '';\n            if (modalEls.root.attr('id') === 'phItemModalView') {\n                modalEls.date.find('span').text(prefix + formattedDate);\n                modalEls.date.show();\n            } else {\n                modalEls.date.text(prefix + formattedDate);\n                if (modalEls.dateContainer) {\n                    modalEls.dateContainer.removeClass('d-none');\n                }\n            }\n        } else {\n            if (modalEls.root.attr('id') === 'phItemModalView') {\n                modalEls.date.hide();\n            } else if (modalEls.dateContainer) {\n                modalEls.dateContainer.addClass('d-none');\n            }\n        }\n\n        modalEls.imgContainer.empty();\n        if (String(data.isImg) === '1') {\n            modalEls.imgContainer.append($('<img>', {src: data.img, 'class': 'ph-modal-img', alt: ''}));\n        } else {\n            modalEls.imgContainer.append($('<span>', {\n                'class': 'ph-modal-emoji',\n                'aria-hidden': 'true',\n                text: data.img\n            }));\n        }\n\n        const modalEl = modalEls.root[0];\n        if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {\n            bootstrap.Modal.getOrCreateInstance(modalEl).show();\n        } else {\n            modalEls.root.modal('show');\n        }\n    });\n\n    // ACTION: COLLECT ITEM.\n    $('body').on('click', '.ph-action-collect', function(e) {\n        e.preventDefault();\n        const trigger = $(this);\n\n        if (trigger.hasClass('disabled') || trigger.attr('aria-disabled')) {\n            return;\n        }\n\n        const originalHtml = trigger.html();\n        toggleLoading(trigger, true);\n\n        const href = trigger.attr('href');\n        if (!href) {\n            toggleLoading(trigger, false, originalHtml);\n            return;\n        }\n\n        const urlObj = new URL(href, window.location.href);\n        const params = {\n            instanceid: parseInt(urlObj.searchParams.get('instanceid')),\n            dropid: parseInt(urlObj.searchParams.get('dropid')),\n            courseid: parseInt(urlObj.searchParams.get('courseid'))\n        };\n\n        if (isNaN(params.instanceid) || isNaN(params.dropid) || isNaN(params.courseid)) {\n            toggleLoading(trigger, false, originalHtml);\n            return;\n        }\n\n        Ajax.call([{\n            methodname: 'block_playerhud_collect_item',\n            args: params\n        }])[0].then((resp) => {\n            if (resp.success) {\n                handleCollectionSuccess(trigger, resp, originalHtml, appStrings);\n                return;\n            }\n\n            toggleLoading(trigger, false, originalHtml);\n            // eslint-disable-next-line consistent-return, promise/no-nesting\n            return Str.get_strings([\n                {key: 'error', component: 'core'},\n                {key: 'ok', component: 'core'}\n            ]).then((strs) => {\n                return Notification.alert(strs[0], resp.message, strs[1]);\n            });\n\n        }).catch((ex) => {\n            toggleLoading(trigger, false, originalHtml);\n            Notification.exception(ex);\n        });\n    });\n};\n"],"names":["appStrings","updateStash","itemData","each","stash","this","closest","removeClass","show","find","remove","children","filter","i","el","attr","name","contentHtml","String","isimage","image","newItem","xp","date","timestamp","append","description","hide","prependTo","fadeIn","limit","hasClass","length","last","updateHud","data","container","tierRegex","removeTierClasses","idx","className","match","join","addClass","level_class","css","progress","levelBadge","labelText","level","lvlString","max_levels","text","indexOf","xpString","currentxp","xp_target","is_win","toggleLoading","trigger","isLoading","originalHtml","mode","outerWidth","html","removeAttr","handleCollectionSuccess","resp","strings","hasTimer","cooldown_deadline","isLimit","limit_reached","item_data","card","badge","currentCount","parseInt","replace","imgWrapper","first","oldColor","setTimeout","updateTextOrImageUi","tHtml","tBtn","replaceWith","focus","collectedText","collected","updateCardUi","game_data","config","$filterModal","appendTo","on","e","preventDefault","url","msg","confirm","confirm_title","yes","cancel","window","location","href","type","key","descB64","descDirect","img","isImg","modalEls","root","suffix","title","desc","imgContainer","countBadge","dateContainer","getModalElements","xpText","isNaN","parseFloat","isFinite","descHtml","str","binString","atob","bytes","Uint8Array","from","m","codePointAt","TextDecoder","decode","safeB64Decode","formattedDate","lang","Date","toLocaleDateString","day","month","year","err","prefix","last_collected","empty","src","alt","modalEl","bootstrap","Modal","getOrCreateInstance","modal","urlObj","URL","params","instanceid","searchParams","get","dropid","courseid","call","methodname","args","then","success","Str","get_strings","component","strs","Notification","alert","message","catch","ex","exception"],"mappings":"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"}