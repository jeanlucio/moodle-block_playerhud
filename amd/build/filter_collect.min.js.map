{"version":3,"file":"filter_collect.min.js","sources":["../src/filter_collect.js"],"sourcesContent":["/* global bootstrap */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Collect items via Filter Shortcodes.\n *\n * @module     block_playerhud/filter_collect\n * @copyright  2026 Jean L√∫cio\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Notification from 'core/notification';\nimport Ajax from 'core/ajax';\nimport Str from 'core/str';\n\n/**\n * Get modal elements ensuring reusability.\n *\n * @return {Object} jQuery objects for modal elements.\n */\nconst getModalElements = () => {\n    let root = $('#phItemModalView');\n    let suffix = 'View';\n\n    if (!root.length) {\n        root = $('#phItemModalFilter');\n        suffix = 'F';\n    }\n\n    return {\n        root: root,\n        title: $(`#phModalTitle${suffix}`),\n        name: $(`#phModalName${suffix}`),\n        desc: $(`#phModalDesc${suffix}`),\n        imgContainer: $(`#phModalImageContainer${suffix}`),\n        xp: $(`#phModalXP${suffix}`),\n        countBadge: $(`#phModalCountBadge${suffix}`),\n        date: $(`#phModalDate${suffix}`),\n        dateContainer: $(`#phModalDateContainer${suffix}`)\n    };\n};\n\n/**\n * Updates the Player HUD sidebar with new stats.\n *\n * @param {Object} data Game data from server.\n * @param {Object} itemData Collected item data.\n */\nconst updateHud = (data, itemData) => {\n    const containers = $('.playerhud-widget-container, .block_playerhud_sidebar');\n\n    containers.each(function() {\n        const container = $(this);\n\n        // Update Level Classes.\n        const tierRegex = /(^|\\s)ph-lvl-tier-\\S+/g;\n        const removeTierClasses = (idx, className) => (className.match(tierRegex) || []).join(' ');\n\n        if (container.hasClass('playerhud-widget-container')) {\n            container.removeClass(removeTierClasses).addClass(data.level_class);\n        }\n\n        container.find('.ph-sidebar-grid, .progress-bar, .badge').each(function() {\n            $(this).removeClass(removeTierClasses).addClass(data.level_class);\n        });\n\n        // Update Progress Bar.\n        const progressBar = container.find('.progress-bar');\n        progressBar.css('width', `${data.progress}%`).attr('aria-valuenow', data.progress);\n\n        // Update Level Badge.\n        const levelBadge = container.find('.badge').filter(function() {\n            return $(this).text().match(/(Level|N√≠vel)/) || $(this).attr('class').match(/ph-lvl-tier-/);\n        });\n\n        if (levelBadge.length) {\n            const labelText = (levelBadge.text().indexOf('N√≠vel') > -1) ? 'N√≠vel' : 'Level';\n            let lvlString = `${data.level}`;\n            if (data.max_levels > 0) {\n                lvlString += `/${data.max_levels}`;\n            }\n            levelBadge.text(`${labelText} ${lvlString}`);\n        }\n\n        // Update XP Text.\n        container.find('span, div, strong').each(function() {\n            const el = $(this);\n            if (el.children().length === 0 && el.text().indexOf('XP') > -1) {\n                let xpString = `${data.currentxp}`;\n                if (data.xp_target > 0) {\n                    xpString += ` / ${data.xp_target}`;\n                }\n                xpString += ' XP';\n                if (data.is_win) {\n                    xpString += ' üèÜ';\n                }\n                el.text(xpString);\n            }\n        });\n    });\n\n    if (itemData) {\n        updateStash(itemData);\n    }\n};\n\n/**\n * Updates the stash (recent items) in the sidebar.\n *\n * @param {Object} itemData\n */\nconst updateStash = (itemData) => {\n    const stashes = $('.ph-sidebar-stash, .ph-widget-stash');\n\n    stashes.each(function() {\n        const stash = $(this);\n        stash.closest('.ph-stash-wrapper').removeClass('d-none').show();\n        stash.find('.text-muted, span.small').remove();\n\n        // Check duplicated by name and remove.\n        stash.children().filter((i, el) => $(el).attr('data-name') === itemData.name).remove();\n\n        const isImage = String(itemData.isimage) === '1';\n        let contentHtml = '';\n\n        if (isImage) {\n            contentHtml = `<img src=\"${itemData.image}\" alt=\"\" class=\"ph-mini-item-img\">`;\n        } else {\n            contentHtml = `<span class=\"ph-mini-emoji\" aria-hidden=\"true\">${itemData.image}</span>`;\n        }\n\n        const newItem = $('<div>', {\n            'class': 'ph-mini-item ph-item-trigger border bg-white rounded ' +\n                     'd-flex align-items-center justify-content-center overflow-hidden position-relative shadow-sm',\n            'role': 'button',\n            'tabindex': '0',\n            'data-name': itemData.name,\n            'data-xp': itemData.xp,\n            'data-image': itemData.image,\n            'data-isimage': itemData.isimage,\n            'data-date': itemData.date,\n            'data-timestamp': itemData.timestamp || 0,\n            'title': itemData.name,\n            'aria-label': itemData.name\n        });\n\n        newItem.append(`<div class=\"d-none ph-item-description-content\">${itemData.description || ''}</div>`);\n        newItem.append(contentHtml);\n\n        newItem.hide().prependTo(stash).fadeIn();\n\n        const limit = stash.hasClass('ph-widget-stash') ? 14 : 6;\n        if (stash.children('.ph-mini-item').length > limit) {\n            stash.children('.ph-mini-item').last().remove();\n        }\n    });\n};\n\n/**\n * Handles the collection button loading state.\n *\n * @param {Object} trigger jQuery element.\n * @param {Boolean} isLoading\n * @param {String} originalHtml\n */\nconst toggleLoading = (trigger, isLoading, originalHtml = '') => {\n    const mode = trigger.attr('data-mode') || 'card';\n\n    if (isLoading) {\n        trigger.addClass('disabled').attr('aria-disabled', 'true');\n        if (mode === 'card') {\n            // Set fixed width to prevent layout jump.\n            trigger.css('width', trigger.outerWidth() + 'px');\n            trigger.html('<i class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></i>');\n        } else {\n            trigger.addClass('ph-opacity-50').css('pointer-events', 'none');\n        }\n    } else {\n        trigger.removeClass('disabled').removeAttr('aria-disabled');\n        if (mode === 'card') {\n            trigger.css('width', '');\n            trigger.html(originalHtml);\n        } else {\n            trigger.removeClass('ph-opacity-50').css('pointer-events', 'auto');\n        }\n    }\n};\n\n/**\n * Updates UI for Text or Image mode.\n *\n * @param {Object} trigger The jQuery element.\n * @param {String} mode 'text' or 'image'.\n * @param {Boolean} hasTimer If has cooldown.\n * @param {Boolean} isLimit If limit reached.\n * @param {Object} resp Response data.\n */\nconst updateTextOrImageUi = (trigger, mode, hasTimer, isLimit, resp) => {\n    if (hasTimer || isLimit) {\n        if (mode === 'text') {\n            trigger.removeAttr('href').removeClass('ph-action-collect').addClass('ph-item-details-trigger');\n            trigger.css({'cursor': 'pointer', 'pointer-events': 'auto', 'opacity': '1'});\n\n            if (isLimit) {\n                trigger.addClass('text-success fw-bold')\n                    .html(`<i class=\"fa fa-check\" aria-hidden=\"true\"></i> ${trigger.text()}`);\n            } else {\n                trigger.addClass('ph-text-dimmed')\n                    .html(`<span aria-hidden=\"true\">‚è≥</span> ${trigger.text()} ` +\n                          `<small class=\"ph-timer\" data-deadline=\"${resp.cooldown_deadline}\">...</small>`);\n            }\n        } else {\n            // Image Mode.\n            const container = trigger.closest('.ph-drop-image-container');\n            const imgWrapper = container.find('> div').first();\n            trigger.remove(); // Remove link.\n\n            container.addClass('ph-item-details-trigger ph-cursor-pointer')\n                     .attr({'tabindex': '0', 'role': 'button'});\n\n            if (isLimit) {\n                imgWrapper.addClass('ph-state-grayscale');\n                container.append('<span class=\"badge bg-success rounded-circle ph-badge-bottom-right\">' +\n                    '<i class=\"fa fa-check\" aria-hidden=\"true\"></i></span>');\n            } else {\n                imgWrapper.addClass('ph-state-dimmed');\n                container.append(`<div class=\"ph-timer badge bg-light text-dark border shadow-sm ph-badge-bottom-center\"\n                    data-deadline=\"${resp.cooldown_deadline}\" data-no-label=\"1\">...</div>`);\n            }\n        }\n    } else if (mode === 'text') {\n        // Success flash for text.\n        const oldColor = trigger.css('color');\n        trigger.css('color', '#198754'); // Bootstrap success.\n        setTimeout(() => trigger.css('color', oldColor), 1000);\n    }\n};\n\n/**\n * Updates UI for Card mode.\n *\n * @param {Object} trigger The jQuery element.\n * @param {Boolean} hasTimer If has cooldown.\n * @param {Boolean} isLimit If limit reached.\n * @param {Object} resp Response data.\n * @param {String} originalHtml Original button HTML.\n * @param {Object} strings Localized strings.\n */\nconst updateCardUi = (trigger, hasTimer, isLimit, resp, originalHtml, strings) => {\n    if (hasTimer) {\n        trigger.removeClass('btn-primary ph-action-collect').removeAttr('href');\n        const tHtml = `‚è≥ <span class=\"ph-timer\" data-deadline=\"${resp.cooldown_deadline}\">...</span>`;\n        const tBtn = $(`<div class=\"btn btn-light btn-sm w-100 ph-text-dimmed\" tabindex=\"0\">${tHtml}</div>`);\n        trigger.replaceWith(tBtn);\n        tBtn.focus();\n    } else if (isLimit) {\n        trigger.removeClass('btn-primary ph-action-collect')\n            .addClass('btn-light text-success disabled border-success')\n            .css('cursor', 'default').removeAttr('href')\n            .html(`<i class=\"fa fa-check\" aria-hidden=\"true\"></i> ${strings.collected}`);\n        trigger.closest('.playerhud-item-card').find('.ph-item-details-trigger').focus();\n    } else {\n        trigger.removeClass('btn-primary disabled').addClass('btn-success')\n            .html(`<i class=\"fa fa-check\" aria-hidden=\"true\"></i> ${strings.collected}`).css('width', '');\n\n        setTimeout(() => {\n            trigger.removeClass('btn-success').addClass('btn-primary').html(originalHtml);\n            trigger.focus();\n        }, 1500);\n    }\n};\n\n/**\n * Process the collection result UI updates (Orchestrator).\n *\n * @param {Object} trigger The jQuery element.\n * @param {Object} resp The ajax response.\n * @param {String} originalHtml The original HTML.\n * @param {Object} strings Localized strings.\n */\nconst handleCollectionSuccess = (trigger, resp, originalHtml, strings) => {\n    const mode = trigger.attr('data-mode') || 'card';\n    const hasTimer = (resp.cooldown_deadline && resp.cooldown_deadline > 0);\n    const isLimit = resp.limit_reached;\n\n    // Update item data on card attributes.\n    if (resp.item_data) {\n        const card = trigger.closest('.playerhud-item-card');\n        if (card.length) {\n            const badge = card.find('.ph-badge-count');\n            if (card.attr('data-unique') !== '1') {\n                const currentCount = parseInt(badge.text().replace('x', ''), 10) || 0;\n                badge.text('x' + (currentCount + 1)).removeClass('d-none').show();\n            }\n            card.attr('data-date', resp.item_data.date);\n            card.attr('data-timestamp', resp.item_data.timestamp);\n        }\n\n        if (mode === 'image') {\n            trigger.closest('.ph-drop-image-container').attr({\n                'data-date': resp.item_data.date,\n                'data-timestamp': resp.item_data.timestamp\n            });\n        }\n    }\n\n    // Call specific UI updaters to reduce complexity.\n    if (mode === 'text' || mode === 'image') {\n        updateTextOrImageUi(trigger, mode, hasTimer, isLimit, resp);\n    } else {\n        updateCardUi(trigger, hasTimer, isLimit, resp, originalHtml, strings);\n    }\n\n    if (resp.game_data) {\n        updateHud(resp.game_data, resp.item_data);\n    }\n};\n\n/**\n * Initialize.\n *\n * @param {Object} config Configuration object passed from PHP.\n */\nexport const init = (config) => {\n    // Ensure strings are available.\n    const strings = config.strings;\n\n    // Move modal to body.\n    const $filterModal = $('#phItemModalFilter');\n    if ($filterModal.length) {\n        $filterModal.appendTo('body');\n    }\n\n    // Disable HUD Confirmation.\n    $('body').on('click', '.js-disable-hud', function(e) {\n        e.preventDefault();\n        const url = $(this).attr('href');\n        const msg = $(this).attr('data-confirm-msg');\n\n        Notification.confirm(\n            strings.confirm_title,\n            msg,\n            strings.yes,\n            strings.cancel,\n            () => {\n                window.location.href = url;\n            }\n        );\n    });\n\n    // Item Details Modal.\n    // eslint-disable-next-line complexity\n    $('body').on('click keydown', '.ph-item-details-trigger', function(e) {\n        if (e.type === 'keydown' && e.key !== 'Enter' && e.key !== ' ') {\n            return;\n        }\n        e.preventDefault();\n\n        const trigger = $(this);\n        let container = trigger.closest('.playerhud-item-card, .ph-drop-image-container, .ph-mini-item');\n        if (!container.length) {\n            container = trigger;\n        }\n\n        const data = {\n            name: container.attr('data-name'),\n            descB64: container.attr('data-desc-b64'),\n            descDirect: container.find('.ph-item-description-content').html(),\n            img: container.attr('data-image'),\n            isImg: container.attr('data-isimage'),\n            xp: container.attr('data-xp'),\n            date: container.attr('data-date'),\n            timestamp: container.attr('data-timestamp')\n        };\n\n        const modalEls = getModalElements();\n        if (!modalEls.root.length) {\n            return;\n        }\n\n        modalEls.title.text(data.name);\n        modalEls.name.text(data.name);\n\n        // CORRE√á√ÉO CR√çTICA: Convertendo XP para string antes de usar indexOf\n        // Isso previne o erro \"data.xp.indexOf is not a function\" quando XP √© num√©rico.\n        if (data.xp && data.xp !== '0') {\n            const xpStr = String(data.xp);\n            if (xpStr.indexOf('???') === -1) {\n                const xpText = $.isNumeric(data.xp) ? `${data.xp} XP` : data.xp;\n                modalEls.xp.text(xpText).removeClass('d-none').show();\n            } else {\n                modalEls.xp.hide();\n            }\n        } else {\n            modalEls.xp.hide();\n        }\n\n        if (modalEls.countBadge.length) {\n            modalEls.countBadge.hide();\n        }\n\n        let descHtml = '...';\n        if (data.descDirect) {\n            descHtml = data.descDirect;\n        } else if (data.descB64) {\n            try {\n                descHtml = decodeURIComponent(escape(window.atob(data.descB64)));\n            } catch (err) { /* Ignore */ }\n        }\n        modalEls.desc.html(descHtml);\n\n        // Date Handling.\n        let formattedDate = data.date;\n        if (data.timestamp && data.timestamp > 0) {\n            const lang = $('html').attr('lang').replace('_', '-') || 'en';\n            try {\n                formattedDate = new Date(parseInt(data.timestamp) * 1000).toLocaleDateString(lang, {\n                    day: '2-digit', month: '2-digit', year: '2-digit'\n                });\n            } catch (err) { /* Ignore */ }\n        }\n\n        if (formattedDate) {\n            const prefix = strings.last_collected ? `${strings.last_collected} ` : '';\n            if (modalEls.root.attr('id') === 'phItemModalView') {\n                modalEls.date.find('span').text(prefix + formattedDate);\n                modalEls.date.show();\n            } else {\n                modalEls.date.text(prefix + formattedDate);\n                if (modalEls.dateContainer) {\n                    modalEls.dateContainer.removeClass('d-none');\n                }\n            }\n        } else {\n            if (modalEls.root.attr('id') === 'phItemModalView') {\n                modalEls.date.hide();\n            } else if (modalEls.dateContainer) {\n                modalEls.dateContainer.addClass('d-none');\n            }\n        }\n\n        // Image.\n        modalEls.imgContainer.empty();\n        if (String(data.isImg) === '1') {\n            modalEls.imgContainer.append($('<img>', {src: data.img, 'class': 'ph-modal-img', alt: ''}));\n        } else {\n            modalEls.imgContainer.append($('<span>', {\n                'class': 'ph-modal-emoji',\n                'aria-hidden': 'true',\n                text: data.img\n            }));\n        }\n\n        // Open Modal.\n        const modalEl = modalEls.root[0];\n        if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {\n            bootstrap.Modal.getOrCreateInstance(modalEl).show();\n        } else {\n            modalEls.root.modal('show');\n        }\n    });\n\n    // ACTION: COLLECT ITEM.\n    $('body').on('click', '.ph-action-collect', function(e) {\n        e.preventDefault();\n        const trigger = $(this);\n\n        if (trigger.hasClass('disabled') || trigger.attr('aria-disabled')) {\n            return;\n        }\n\n        const originalHtml = trigger.html();\n        toggleLoading(trigger, true);\n\n        // Extract params safely.\n        const href = trigger.attr('href');\n        if (!href) {\n            toggleLoading(trigger, false, originalHtml);\n            return;\n        }\n\n        const urlObj = new URL(href, window.location.href);\n        const params = {\n            instanceid: parseInt(urlObj.searchParams.get('instanceid')),\n            dropid: parseInt(urlObj.searchParams.get('dropid')),\n            courseid: parseInt(urlObj.searchParams.get('courseid'))\n        };\n\n        // CORRE√á√ÉO CR√çTICA: Validar par√¢metros num√©ricos antes do Ajax\n        // Evita \"Invalid parameter value detected\"\n        if (isNaN(params.instanceid) || isNaN(params.dropid) || isNaN(params.courseid)) {\n            toggleLoading(trigger, false, originalHtml);\n            // eslint-disable-next-line no-console\n            console.error('PlayerHUD: Invalid collection parameters.', params);\n            return;\n        }\n\n        Ajax.call([{\n            methodname: 'block_playerhud_collect_item',\n            args: params\n        }])[0].then((resp) => {\n            if (resp.success) {\n                handleCollectionSuccess(trigger, resp, originalHtml, strings);\n            } else {\n                toggleLoading(trigger, false, originalHtml);\n                // eslint-disable-next-line promise/no-nesting\n                Str.get_strings([\n                    {key: 'error', component: 'core'},\n                    {key: 'ok', component: 'core'}\n                ]).then((strs) => {\n                    Notification.alert(strs[0], resp.message, strs[1]);\n                    return;\n                }).catch(() => { /* Ignore */ });\n            }\n            return;\n        }).catch((ex) => {\n            toggleLoading(trigger, false, originalHtml);\n            Notification.exception(ex);\n        });\n    });\n};\n"],"names":["updateHud","data","itemData","each","container","this","tierRegex","removeTierClasses","idx","className","match","join","hasClass","removeClass","addClass","level_class","find","css","progress","attr","levelBadge","filter","text","length","labelText","indexOf","lvlString","level","max_levels","el","children","xpString","currentxp","xp_target","is_win","updateStash","stash","closest","show","remove","i","name","contentHtml","String","isimage","image","newItem","xp","date","timestamp","append","description","hide","prependTo","fadeIn","limit","last","toggleLoading","trigger","isLoading","originalHtml","mode","outerWidth","html","removeAttr","handleCollectionSuccess","resp","strings","hasTimer","cooldown_deadline","isLimit","limit_reached","item_data","card","badge","currentCount","parseInt","replace","imgWrapper","first","oldColor","setTimeout","updateTextOrImageUi","tHtml","tBtn","replaceWith","focus","collected","updateCardUi","game_data","config","$filterModal","appendTo","on","e","preventDefault","url","msg","confirm","confirm_title","yes","cancel","window","location","href","type","key","descB64","descDirect","img","isImg","modalEls","root","suffix","title","desc","imgContainer","countBadge","dateContainer","getModalElements","xpText","$","isNumeric","descHtml","decodeURIComponent","escape","atob","err","formattedDate","lang","Date","toLocaleDateString","day","month","year","prefix","last_collected","empty","src","alt","modalEl","bootstrap","Modal","getOrCreateInstance","modal","urlObj","URL","params","instanceid","searchParams","get","dropid","courseid","isNaN","console","error","call","methodname","args","then","success","get_strings","component","strs","alert","message","catch","ex","exception"],"mappings":"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"}