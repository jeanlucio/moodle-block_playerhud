{"version":3,"file":"filter_collect.min.js","sources":["../src/filter_collect.js"],"sourcesContent":["define(['jquery', 'core/notification'], function($, Notification) {\n\n    return {\n        init: function(strings) {\n\n            $('body').on('click', '.ph-action-collect', function(e) {\n                e.preventDefault();\n\n                var trigger = $(this);\n\n                // Ignora se já estiver desabilitado\n                if (trigger.hasClass('disabled') || trigger.attr('disabled')) {\n                    return;\n                }\n\n                var originalHtml = trigger.html();\n                var originalWidth = trigger.outerWidth();\n\n                trigger.css('width', originalWidth + 'px');\n                trigger.html('<i class=\"fa fa-spinner fa-spin\"></i>');\n                trigger.addClass('disabled').attr('aria-busy', 'true');\n\n                var url = trigger.attr('href');\n                var ajaxUrl = url + (url.indexOf('?') === -1 ? '?' : '&') + 'ajax=1';\n\n                $.ajax({\n                    url: ajaxUrl,\n                    method: 'GET',\n                    dataType: 'json',\n                    success: function(resp) {\n                        if (resp.success) {\n\n                            // Remove classes antigas\n                            trigger.removeClass('btn-primary ph-action-collect')\n                                .removeAttr('href')\n                                .removeAttr('aria-busy');\n\n                            // --- LÓGICA DO CONTADOR ---\n                            if (resp.cooldown_deadline && resp.cooldown_deadline > 0) {\n                                // 1. MODO TEMPORIZADOR\n                                // eslint-disable-next-line max-len\n                                var timerHtml = '⏳ <span class=\"ph-timer\" data-deadline=\"' + resp.cooldown_deadline + '\">...</span>';\n\n                                // eslint-disable-next-line max-len\n                                var timerBtn = $('<div class=\"btn btn-light btn-sm w-100 text-muted\" tabindex=\"0\" role=\"timer\" aria-live=\"off\">' + timerHtml + '</div>');\n\n                                trigger.replaceWith(timerBtn);\n\n                                // Foca no novo elemento do timer\n                                timerBtn.focus();\n\n                            } else {\n                                // 2. MODO COLETADO\n                                trigger.addClass('btn-success disabled')\n                                    .css('cursor', 'default')\n                                    .attr('aria-disabled', 'true')\n                                    .html('<i class=\"fa fa-check\"></i> ' + strings.collected);\n\n                                trigger.attr('tabindex', '0');\n                                trigger.focus();\n                            }\n\n                            // --- ATUALIZAÇÃO DO HUD (XP/Level) ---\n                            if (resp.game_data) {\n                                var widget = $('.playerhud-widget-container');\n                                if (widget.length) {\n                                    var data = resp.game_data;\n                                    // eslint-disable-next-line max-len\n                                    widget.find('.progress-bar').css('width', data.progress + '%').attr('aria-valuenow', data.progress);\n\n                                    widget.find('.badge').each(function() {\n                                        var text = $(this).text();\n                                        if (text.indexOf('Level') !== -1 || text.indexOf('Nível') !== -1) {\n                                            $(this).text('Level ' + data.level);\n                                            $(this).addClass('animate__animated animate__pulse');\n                                        }\n                                    });\n\n                                    widget.find('span.text-muted').each(function() {\n                                        var el = $(this);\n                                        if (el.text().indexOf('XP') !== -1) {\n                                            el.text(data.currentxp + ' XP');\n                                            el.addClass('text-success fw-bold');\n                                            setTimeout(function() {\n                                                el.removeClass('text-success fw-bold');\n                                            }, 2000);\n                                        }\n                                    });\n                                }\n                            }\n\n                            // Removida a variável 'card' que não estava sendo usada para evitar erro de lint.\n\n                        } else {\n                            restaurarBotao();\n                            Notification.alert('Ops', resp.message, 'OK');\n                        }\n                    },\n                    error: function() {\n                        restaurarBotao();\n                        Notification.alert('Erro', strings.error, 'OK');\n                    }\n                });\n\n                /**\n                 *\n                 */\n                function restaurarBotao() {\n                    trigger.html(originalHtml);\n                    trigger.removeClass('disabled').removeAttr('aria-busy');\n                    trigger.css('width', '');\n                }\n            });\n        }\n    };\n});\n"],"names":["define","$","Notification","init","strings","on","e","preventDefault","trigger","this","hasClass","attr","originalHtml","html","originalWidth","outerWidth","css","addClass","url","ajaxUrl","indexOf","ajax","method","dataType","success","resp","removeClass","removeAttr","cooldown_deadline","timerHtml","timerBtn","replaceWith","focus","collected","game_data","widget","length","data","find","progress","each","text","level","el","currentxp","setTimeout","restaurarBotao","alert","message","error"],"mappings":"AAAAA,wCAAO,CAAC,SAAU,sBAAsB,SAASC,EAAGC,oBAEzC,CACHC,KAAM,SAASC,SAEXH,EAAE,QAAQI,GAAG,QAAS,sBAAsB,SAASC,GACjDA,EAAEC,qBAEEC,QAAUP,EAAEQ,UAGZD,QAAQE,SAAS,cAAeF,QAAQG,KAAK,iBAI7CC,aAAeJ,QAAQK,OACvBC,cAAgBN,QAAQO,aAE5BP,QAAQQ,IAAI,QAASF,cAAgB,MACrCN,QAAQK,KAAK,yCACbL,QAAQS,SAAS,YAAYN,KAAK,YAAa,YAE3CO,IAAMV,QAAQG,KAAK,QACnBQ,QAAUD,MAA6B,IAAtBA,IAAIE,QAAQ,KAAc,IAAM,KAAO,SAE5DnB,EAAEoB,KAAK,CACHH,IAAKC,QACLG,OAAQ,MACRC,SAAU,OACVC,QAAS,SAASC,SACVA,KAAKD,QAAS,IAGdhB,QAAQkB,YAAY,iCACfC,WAAW,QACXA,WAAW,aAGZF,KAAKG,mBAAqBH,KAAKG,kBAAoB,EAAG,KAGlDC,UAAY,2CAA6CJ,KAAKG,kBAAoB,eAGlFE,SAAW7B,EAAE,gGAAkG4B,UAAY,UAE/HrB,QAAQuB,YAAYD,UAGpBA,SAASE,aAITxB,QAAQS,SAAS,wBACZD,IAAI,SAAU,WACdL,KAAK,gBAAiB,QACtBE,KAAK,+BAAiCT,QAAQ6B,WAEnDzB,QAAQG,KAAK,WAAY,KACzBH,QAAQwB,WAIRP,KAAKS,UAAW,KACZC,OAASlC,EAAE,kCACXkC,OAAOC,OAAQ,KACXC,KAAOZ,KAAKS,UAEhBC,OAAOG,KAAK,iBAAiBtB,IAAI,QAASqB,KAAKE,SAAW,KAAK5B,KAAK,gBAAiB0B,KAAKE,UAE1FJ,OAAOG,KAAK,UAAUE,MAAK,eACnBC,KAAOxC,EAAEQ,MAAMgC,QACY,IAA3BA,KAAKrB,QAAQ,WAA8C,IAA3BqB,KAAKrB,QAAQ,WAC7CnB,EAAEQ,MAAMgC,KAAK,SAAWJ,KAAKK,OAC7BzC,EAAEQ,MAAMQ,SAAS,wCAIzBkB,OAAOG,KAAK,mBAAmBE,MAAK,eAC5BG,GAAK1C,EAAEQ,OACsB,IAA7BkC,GAAGF,OAAOrB,QAAQ,QAClBuB,GAAGF,KAAKJ,KAAKO,UAAY,OACzBD,GAAG1B,SAAS,wBACZ4B,YAAW,WACPF,GAAGjB,YAAY,0BAChB,gBASnBoB,iBACA5C,aAAa6C,MAAM,MAAOtB,KAAKuB,QAAS,OAGhDC,MAAO,WACHH,iBACA5C,aAAa6C,MAAM,OAAQ3C,QAAQ6C,MAAO,kBAOzCH,iBACLtC,QAAQK,KAAKD,cACbJ,QAAQkB,YAAY,YAAYC,WAAW,aAC3CnB,QAAQQ,IAAI,QAAS"}