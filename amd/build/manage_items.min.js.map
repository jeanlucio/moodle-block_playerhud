{"version":3,"file":"manage_items.min.js","sources":["../src/manage_items.js"],"sourcesContent":["define(['jquery', 'core/notification'], function($, Notification) {\n\n    return {\n        init: function(config) {\n\n            $('#phAiModal').appendTo('body');\n\n            // 1. Toggle Drop Options\n            $('#ai-drop').on('change', function() {\n                if ($(this).is(':checked')) {\n                    $('#ai-drop-options').slideDown();\n                } else {\n                    $('#ai-drop-options').slideUp();\n                }\n            });\n\n            // 2. Delete Confirmation\n            $('body').on('click', '.js-delete-btn', function(e) {\n                e.preventDefault();\n                var btn = $(this);\n                var targetUrl = btn.attr('href');\n                var msg = btn.attr('data-confirm-msg');\n\n                Notification.confirm(\n                    config.strings.confirm_title,\n                    msg,\n                    config.strings.yes,\n                    config.strings.cancel,\n                    function() {\n                        window.location.href = targetUrl;\n                    }\n                );\n            });\n\n            $('#ph-ai-form').on('submit', function(e) {\n                e.preventDefault();\n                $('#ph-btn-conjure').click();\n            });\n\n            // 3. AI Logic\n            $('#ph-btn-conjure').click(function(e) {\n                e.preventDefault();\n                var btn = $(this);\n\n                if (btn.prop('disabled')) {\n                    return;\n                }\n\n                var theme = $('#ai-theme').val();\n                var xp = $('#ai-xp').val();\n                var createDrop = $('#ai-drop').is(':checked');\n\n                var locName = $('#ai-location').val();\n                var maxUsage = $('#ai-maxusage').val();\n                var respawn = $('#ai-respawn').val();\n\n                if (!theme) {\n                    Notification.alert('Error', config.strings.err_theme, 'OK');\n                    return;\n                }\n\n                var originalText = btn.text();\n                btn.prop('disabled', true).text(config.strings.ai_creating);\n                btn.attr('aria-busy', 'true');\n\n                $.ajax({\n                    url: M.cfg.wwwroot + '/blocks/playerhud/ajax_ai.php',\n                    method: 'POST',\n                    dataType: 'json',\n                    data: {\n                        instanceid: config.instanceid,\n                        id: config.courseid,\n                        theme: theme,\n                        xp: xp ? xp : 0,\n                        'create_drop': createDrop ? 1 : 0,\n                        'drop_location': locName,\n                        'drop_max': maxUsage,\n                        'drop_time': respawn,\n                        sesskey: M.cfg.sesskey\n                    },\n                    success: function(resp) {\n                        btn.prop('disabled', false).text(originalText).removeAttr('aria-busy');\n\n                        if (resp.success) {\n                            var modalBody = $('#phAiModal .modal-body');\n                            var modalFooter = $('#phAiModal .modal-footer');\n                            var modalTitle = $('#phAiModalLabel');\n\n                            // --- LAYOUT DE SUCESSO MELHORADO ---\n                            modalTitle.text(config.strings.success_title);\n\n                            // eslint-disable-next-line max-len\n                            var successHtml = '<div id=\"ph-success-container\" tabindex=\"-1\" class=\"text-center py-3 animate__animated animate__fadeIn\" style=\"outline: none;\">';\n\n                            // Ícone de Sucesso\n                            // eslint-disable-next-line max-len\n                            successHtml += '<div class=\"mb-3\" style=\"font-size: 3rem; color: #28a745;\" aria-hidden=\"true\"><i class=\"fa fa-check-circle\"></i></div>';\n\n                            // Nome do Item\n                            successHtml += '<h2 class=\"fw-bold text-primary mb-3\">' + resp.item_name + '</h2>';\n                            successHtml += '<p class=\"lead text-muted mb-4\">' + config.strings.success + '</p>';\n\n                            // Se houve drop criado, exibe o shortcode completo com botão de copiar\n                            if (resp.drop_code) {\n                                // Monta o código completo\n                                var fullShortcode = '[PLAYERHUD_DROP code=' + resp.drop_code + ']';\n\n                                successHtml += '<div class=\"card bg-light border-0 p-3 mx-auto\" style=\"max-width: 90%;\">';\n                                // eslint-disable-next-line max-len\n                                successHtml += '<label class=\"small text-muted mb-2 fw-bold text-start w-100\" for=\"ph-gen-code-input\">' + config.strings.copy + ':</label>';\n\n                                // Input Group do Bootstrap para juntar Input + Botão\n                                successHtml += '<div class=\"input-group\">';\n                                // eslint-disable-next-line max-len\n                                successHtml += '<input type=\"text\" class=\"form-control font-monospace text-center\" value=\"' + fullShortcode + '\" id=\"ph-gen-code-input\" readonly>';\n                                // eslint-disable-next-line max-len\n                                successHtml += '<button class=\"btn btn-primary\" type=\"button\" id=\"ph-btn-copy-code\"><i class=\"fa fa-copy\"></i></button>';\n                                successHtml += '</div>';\n\n                                successHtml += '</div>';\n                            }\n                            successHtml += '</div>';\n\n                            modalBody.html(successHtml);\n\n                            // Botão \"Legal\" para fechar/recarregar\n                            // eslint-disable-next-line max-len\n                            var btnReload = $('<button class=\"btn btn-success w-100 py-2 fw-bold\">' + config.strings.great + '</button>');\n                            btnReload.on('click', function() {\n                                window.location.reload();\n                            });\n\n                            modalFooter.empty().append(btnReload);\n\n                            // --- LÓGICA DO BOTÃO COPIAR ---\n                            if (resp.drop_code) {\n                                setTimeout(function() {\n                                    $('#ph-btn-copy-code').on('click', function() {\n                                        var copyText = document.getElementById(\"ph-gen-code-input\");\n\n                                        // Seleciona o texto\n                                        copyText.select();\n                                        copyText.setSelectionRange(0, 99999); // Mobile\n\n                                        // Copia para a área de transferência\n                                        document.execCommand(\"copy\");\n\n                                        // Feedback Visual no Botão\n                                        var $btn = $(this);\n                                        var originalIcon = '<i class=\"fa fa-copy\"></i>';\n\n                                        $btn.removeClass('btn-primary').addClass('btn-success').html('<i class=\"fa fa-check\"></i>');\n\n                                        // Volta ao normal após 2 segundos\n                                        setTimeout(function() {\n                                            $btn.removeClass('btn-success').addClass('btn-primary').html(originalIcon);\n                                        }, 2000);\n                                    });\n\n                                    // Foca no container para acessibilidade\n                                    $('#ph-success-container').focus();\n                                }, 200);\n                            }\n\n                        } else {\n                            Notification.alert('Error', resp.message, 'OK');\n                        }\n                    },\n                    error: function(xhr, status, error) {\n                        btn.prop('disabled', false).text(originalText).removeAttr('aria-busy');\n                        var errorMsg = error;\n                        if (xhr.responseJSON && xhr.responseJSON.message) {\n                            errorMsg = xhr.responseJSON.message;\n                        } else if (xhr.responseText) {\n                            try {\n                                var r = JSON.parse(xhr.responseText);\n                                if (r.message) {\n                                    errorMsg = r.message;\n                                }\n                            } catch (e) {\n                                /* Empty */\n                            }\n                        }\n                        Notification.alert('Ops!', errorMsg, 'OK');\n                    }\n                });\n            });\n        }\n    };\n});\n"],"names":["define","$","Notification","init","config","appendTo","on","this","is","slideDown","slideUp","e","preventDefault","btn","targetUrl","attr","msg","confirm","strings","confirm_title","yes","cancel","window","location","href","click","prop","theme","val","xp","createDrop","locName","maxUsage","respawn","originalText","text","ai_creating","ajax","url","M","cfg","wwwroot","method","dataType","data","instanceid","id","courseid","sesskey","success","resp","removeAttr","modalBody","modalFooter","success_title","successHtml","item_name","drop_code","fullShortcode","copy","html","btnReload","great","reload","empty","append","setTimeout","copyText","document","getElementById","select","setSelectionRange","execCommand","$btn","removeClass","addClass","focus","alert","message","error","xhr","status","errorMsg","responseJSON","responseText","r","JSON","parse","err_theme"],"mappings":"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"}