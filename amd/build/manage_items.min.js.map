{"version":3,"file":"manage_items.min.js","sources":["../src/manage_items.js"],"sourcesContent":["define(['jquery', 'core/notification'], function($, Notification) {\n\n    return {\n        init: function(config) {\n\n            $('#phAiModal').appendTo('body');\n            // 1. Delete Confirmation\n            $('body').on('click', '.js-delete-btn', function(e) {\n                e.preventDefault();\n                var btn = $(this);\n                var targetUrl = btn.attr('href');\n                var msg = btn.attr('data-confirm-msg');\n\n                Notification.confirm(\n                    config.strings.confirm_title,\n                    msg,\n                    config.strings.yes,\n                    config.strings.cancel,\n                    function() {\n                        window.location.href = targetUrl;\n                    }\n                );\n            });\n\n            // 2. AI Logic (Bootstrap Native)\n            $('#ph-btn-conjure').click(function(e) {\n                e.preventDefault();\n                var btn = $(this);\n\n                // Get values\n                var theme = $('#ai-theme').val();\n                var xp = $('#ai-xp').val();\n                var createDrop = $('#ai-drop').is(':checked');\n\n                if (!theme) {\n                    Notification.alert('Error', config.strings.err_theme, 'OK');\n                    return;\n                }\n\n                // Loading state\n                var originalText = btn.text();\n                btn.prop('disabled', true).text('...');\n\n                // AJAX Call\n                $.ajax({\n                    url: M.cfg.wwwroot + '/blocks/playerhud/ajax_ai.php',\n                    method: 'POST',\n                    dataType: 'json',\n                    data: {\n                        instanceid: config.instanceid,\n                        id: config.courseid,\n                        theme: theme,\n                        xp: xp ? xp : 0,\n                        'create_drop': createDrop ? 1 : 0,\n                        sesskey: M.cfg.sesskey\n                    },\n                    success: function(resp) {\n                        btn.prop('disabled', false).text(originalText);\n\n                        // Hide modal using jQuery/Bootstrap\n                        $('#phAiModal').modal('hide');\n\n                        if (resp.success) {\n                            var rMsg = config.strings.success;\n                            if (resp.drop_code) {\n                                var dHtml = '<div class=\"mt-3 p-3 bg-light border rounded text-center\">';\n                                dHtml += '<h4 class=\"text-primary\">' + resp.drop_code + '</h4>';\n                                dHtml += '<p class=\"small text-muted mb-0\">' + config.strings.copy + '</p>';\n                                dHtml += '</div>';\n                                rMsg += dHtml;\n                            }\n\n                            Notification.alert(\n                                resp.item_name,\n                                rMsg,\n                                config.strings.great\n                            ).then(function() {\n                                window.location.reload();\n                                return true;\n                            }).catch(Notification.exception);\n                        } else {\n                            Notification.alert('Error', resp.message, 'OK');\n                        }\n                    },\n                    error: function(xhr, status, error) {\n                        btn.prop('disabled', false).text(originalText);\n                        Notification.exception(error);\n                    }\n                });\n            });\n        }\n    };\n});\n"],"names":["define","$","Notification","init","config","appendTo","on","e","preventDefault","btn","this","targetUrl","attr","msg","confirm","strings","confirm_title","yes","cancel","window","location","href","click","theme","val","xp","createDrop","is","originalText","text","prop","ajax","url","M","cfg","wwwroot","method","dataType","data","instanceid","id","courseid","sesskey","success","resp","modal","rMsg","drop_code","dHtml","copy","alert","item_name","great","then","reload","catch","exception","message","error","xhr","status","err_theme"],"mappings":"AAAAA,sCAAO,CAAC,SAAU,sBAAsB,SAASC,EAAGC,oBAEzC,CACHC,KAAM,SAASC,QAEXH,EAAE,cAAcI,SAAS,QAEzBJ,EAAE,QAAQK,GAAG,QAAS,kBAAkB,SAASC,GAC7CA,EAAEC,qBACEC,IAAMR,EAAES,MACRC,UAAYF,IAAIG,KAAK,QACrBC,IAAMJ,IAAIG,KAAK,oBAEnBV,aAAaY,QACTV,OAAOW,QAAQC,cACfH,IACAT,OAAOW,QAAQE,IACfb,OAAOW,QAAQG,QACf,WACIC,OAAOC,SAASC,KAAOV,gBAMnCV,EAAE,mBAAmBqB,OAAM,SAASf,GAChCA,EAAEC,qBACEC,IAAMR,EAAES,MAGRa,MAAQtB,EAAE,aAAauB,MACvBC,GAAKxB,EAAE,UAAUuB,MACjBE,WAAazB,EAAE,YAAY0B,GAAG,eAE7BJ,WAMDK,aAAenB,IAAIoB,OACvBpB,IAAIqB,KAAK,YAAY,GAAMD,KAAK,OAGhC5B,EAAE8B,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,gCACrBC,OAAQ,OACRC,SAAU,OACVC,KAAM,CACFC,WAAYnC,OAAOmC,WACnBC,GAAIpC,OAAOqC,SACXlB,MAAOA,MACPE,GAAIA,IAAU,cACCC,WAAa,EAAI,EAChCgB,QAAST,EAAEC,IAAIQ,SAEnBC,QAAS,SAASC,SACdnC,IAAIqB,KAAK,YAAY,GAAOD,KAAKD,cAGjC3B,EAAE,cAAc4C,MAAM,QAElBD,KAAKD,QAAS,KACVG,KAAO1C,OAAOW,QAAQ4B,WACtBC,KAAKG,UAAW,KACZC,MAAQ,6DACZA,OAAS,4BAA8BJ,KAAKG,UAAY,QACxDC,OAAS,oCAAsC5C,OAAOW,QAAQkC,KAAO,OAErEH,MADAE,OAAS,SAIb9C,aAAagD,MACTN,KAAKO,UACLL,KACA1C,OAAOW,QAAQqC,OACjBC,MAAK,kBACHlC,OAAOC,SAASkC,UACT,KACRC,MAAMrD,aAAasD,gBAEtBtD,aAAagD,MAAM,QAASN,KAAKa,QAAS,OAGlDC,MAAO,SAASC,IAAKC,OAAQF,OACzBjD,IAAIqB,KAAK,YAAY,GAAOD,KAAKD,cACjC1B,aAAasD,UAAUE,eAnD3BxD,aAAagD,MAAM,QAAS9C,OAAOW,QAAQ8C,UAAW"}