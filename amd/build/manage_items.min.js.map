{"version":3,"file":"manage_items.min.js","sources":["../src/manage_items.js"],"sourcesContent":["define(['jquery', 'core/notification'], function($, Notification) {\n\n    return {\n        init: function(config) {\n\n            $('#phAiModal').appendTo('body');\n\n            // 1. Delete Confirmation\n            $('body').on('click', '.js-delete-btn', function(e) {\n                e.preventDefault();\n                var btn = $(this);\n                var targetUrl = btn.attr('href');\n                var msg = btn.attr('data-confirm-msg');\n\n                Notification.confirm(\n                    config.strings.confirm_title,\n                    msg,\n                    config.strings.yes,\n                    config.strings.cancel,\n                    function() {\n                        window.location.href = targetUrl;\n                    }\n                );\n            });\n\n            $('#ph-ai-form').on('submit', function(e) {\n                e.preventDefault();\n                $('#ph-btn-conjure').click();\n            });\n\n            // 2. AI Logic\n            $('#ph-btn-conjure').click(function(e) {\n                e.preventDefault();\n                var btn = $(this);\n\n                if (btn.prop('disabled')) {\n                    return;\n                }\n\n                var theme = $('#ai-theme').val();\n                var xp = $('#ai-xp').val();\n                var createDrop = $('#ai-drop').is(':checked');\n\n                if (!theme) {\n                    Notification.alert('Error', config.strings.err_theme, 'OK');\n                    return;\n                }\n\n                var originalText = btn.text();\n                btn.prop('disabled', true).text('...');\n                btn.attr('aria-busy', 'true'); // Acessibilidade: Indica processamento\n\n                $.ajax({\n                    url: M.cfg.wwwroot + '/blocks/playerhud/ajax_ai.php',\n                    method: 'POST',\n                    dataType: 'json',\n                    data: {\n                        instanceid: config.instanceid,\n                        id: config.courseid,\n                        theme: theme,\n                        xp: xp ? xp : 0,\n                        'create_drop': createDrop ? 1 : 0,\n                        sesskey: M.cfg.sesskey\n                    },\n                    success: function(resp) {\n                        btn.prop('disabled', false).text(originalText).removeAttr('aria-busy');\n\n                        if (resp.success) {\n                            var modalBody = $('#phAiModal .modal-body');\n                            var modalFooter = $('#phAiModal .modal-footer');\n                            var modalTitle = $('#phAiModalLabel');\n\n                            // 1. Atualiza o Título do Modal (Ex: \"Espada Mágica\")\n                            // Usamos o nome do item gerado para dar feedback claro\n                            modalTitle.text(resp.item_name);\n\n                            // 2. Constrói HTML de Sucesso Acessível e SEM texto chumbado\n                            // tabindex=\"-1\" permite focar via JS\n                            // eslint-disable-next-line max-len\n                            var successHtml = '<div id=\"ph-success-container\" tabindex=\"-1\" class=\"text-center py-3 animate__animated animate__fadeIn\" style=\"outline: none;\">';\n\n                            // Ícone decorativo (aria-hidden)\n                            // eslint-disable-next-line max-len\n                            successHtml += '<div class=\"mb-3\" style=\"font-size: 3rem; color: #28a745;\" aria-hidden=\"true\"><i class=\"fa fa-check-circle\"></i></div>';\n\n                            // Mensagem de sucesso vinda do PHP ('Item criado com sucesso!')\n                            successHtml += '<h3 class=\"fw-bold h4\">' + config.strings.success + '</h3>';\n\n                            if (resp.drop_code) {\n                                successHtml += '<div class=\"mt-3 p-3 bg-light border rounded\">';\n                                successHtml += '<label class=\"small text-muted mb-1\">' + config.strings.copy + '</label>';\n                                successHtml += '<h4 class=\"text-primary font-monospace select-all\">' + resp.drop_code + '</h4>';\n                                successHtml += '</div>';\n                            }\n                            successHtml += '</div>';\n\n                            // 3. Substitui o conteúdo\n                            modalBody.html(successHtml);\n\n                            // 4. Cria botão de Reload usando a string 'great' ('Legal!')\n                            // E removemos o texto hardcoded \"OK, Atualizar Página\"\n                            // eslint-disable-next-line max-len\n                            var btnReload = $('<button class=\"btn btn-success w-100 py-2 fw-bold\">' + config.strings.great + '</button>');\n                            btnReload.on('click', function() {\n                                window.location.reload();\n                            });\n\n                            modalFooter.empty().append(btnReload);\n\n                            // 5. ACESSIBILIDADE: Gerenciamento de Foco\n                            // Move o foco para o container de sucesso para o leitor de tela narrar o resultado\n                            setTimeout(function() {\n                                $('#ph-success-container').focus();\n                            }, 100);\n\n                        } else {\n                            Notification.alert('Error', resp.message, 'OK');\n                        }\n                    },\n                    error: function(xhr, status, error) {\n                        btn.prop('disabled', false).text(originalText).removeAttr('aria-busy');\n                        Notification.exception(error);\n                    }\n                });\n            });\n        }\n    };\n});\n"],"names":["define","$","Notification","init","config","appendTo","on","e","preventDefault","btn","this","targetUrl","attr","msg","confirm","strings","confirm_title","yes","cancel","window","location","href","click","prop","theme","val","xp","createDrop","is","originalText","text","ajax","url","M","cfg","wwwroot","method","dataType","data","instanceid","id","courseid","sesskey","success","resp","removeAttr","modalBody","modalFooter","item_name","successHtml","drop_code","copy","html","btnReload","great","reload","empty","append","setTimeout","focus","alert","message","error","xhr","status","exception","err_theme"],"mappings":"AAAAA,sCAAO,CAAC,SAAU,sBAAsB,SAASC,EAAGC,oBAEzC,CACHC,KAAM,SAASC,QAEXH,EAAE,cAAcI,SAAS,QAGzBJ,EAAE,QAAQK,GAAG,QAAS,kBAAkB,SAASC,GAC7CA,EAAEC,qBACEC,IAAMR,EAAES,MACRC,UAAYF,IAAIG,KAAK,QACrBC,IAAMJ,IAAIG,KAAK,oBAEnBV,aAAaY,QACTV,OAAOW,QAAQC,cACfH,IACAT,OAAOW,QAAQE,IACfb,OAAOW,QAAQG,QACf,WACIC,OAAOC,SAASC,KAAOV,gBAKnCV,EAAE,eAAeK,GAAG,UAAU,SAASC,GACnCA,EAAEC,iBACFP,EAAE,mBAAmBqB,WAIzBrB,EAAE,mBAAmBqB,OAAM,SAASf,GAChCA,EAAEC,qBACEC,IAAMR,EAAES,UAERD,IAAIc,KAAK,iBAITC,MAAQvB,EAAE,aAAawB,MACvBC,GAAKzB,EAAE,UAAUwB,MACjBE,WAAa1B,EAAE,YAAY2B,GAAG,eAE7BJ,WAKDK,aAAepB,IAAIqB,OACvBrB,IAAIc,KAAK,YAAY,GAAMO,KAAK,OAChCrB,IAAIG,KAAK,YAAa,QAEtBX,EAAE8B,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,gCACrBC,OAAQ,OACRC,SAAU,OACVC,KAAM,CACFC,WAAYnC,OAAOmC,WACnBC,GAAIpC,OAAOqC,SACXjB,MAAOA,MACPE,GAAIA,IAAU,cACCC,WAAa,EAAI,EAChCe,QAAST,EAAEC,IAAIQ,SAEnBC,QAAS,SAASC,SACdnC,IAAIc,KAAK,YAAY,GAAOO,KAAKD,cAAcgB,WAAW,aAEtDD,KAAKD,QAAS,KACVG,UAAY7C,EAAE,0BACd8C,YAAc9C,EAAE,4BACHA,EAAE,mBAIR6B,KAAKc,KAAKI,eAKjBC,YAAc,kIAIlBA,aAAe,yHAGfA,aAAe,0BAA4B7C,OAAOW,QAAQ4B,QAAU,QAEhEC,KAAKM,YACLD,aAAe,iDACfA,aAAe,wCAA0C7C,OAAOW,QAAQoC,KAAO,WAC/EF,aAAe,sDAAwDL,KAAKM,UAAY,QACxFD,aAAe,UAEnBA,aAAe,SAGfH,UAAUM,KAAKH,iBAKXI,UAAYpD,EAAE,sDAAwDG,OAAOW,QAAQuC,MAAQ,aACjGD,UAAU/C,GAAG,SAAS,WAClBa,OAAOC,SAASmC,YAGpBR,YAAYS,QAAQC,OAAOJ,WAI3BK,YAAW,WACPzD,EAAE,yBAAyB0D,UAC5B,UAGHzD,aAAa0D,MAAM,QAAShB,KAAKiB,QAAS,OAGlDC,MAAO,SAASC,IAAKC,OAAQF,OACzBrD,IAAIc,KAAK,YAAY,GAAOO,KAAKD,cAAcgB,WAAW,aAC1D3C,aAAa+D,UAAUH,eA7E3B5D,aAAa0D,MAAM,QAASxD,OAAOW,QAAQmD,UAAW"}