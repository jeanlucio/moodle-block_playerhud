{"version":3,"file":"timers.min.js","sources":["../src/timers.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Timer logic for PlayerHUD Block.\n *\n * @module     block_playerhud/timers\n * @copyright  2026 Jean LÃºcio\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function($) {\n    return {\n        init: function(strings) {\n            // Avoid running multiple intervals if init is called multiple times.\n            if (window.phTimerInterval) {\n                return;\n            }\n\n            // Update function.\n            const updateTimers = () => {\n                const now = Math.floor(Date.now() / 1000);\n                let reloadNeeded = false;\n\n                $('.ph-timer').each(function() {\n                    const el = $(this);\n                    // If already marked for reloading, skip.\n                    if (el.data('reloading')) {\n                        return;\n                    }\n\n                    const deadline = parseInt(el.attr('data-deadline'));\n                    if (isNaN(deadline)) {\n                        return;\n                    }\n\n                    const diff = deadline - now;\n                    if (diff <= 0) {\n                        // --- TIME UP ---\n                        el.text(strings.ready);\n                        el.removeClass('text-muted').addClass('text-success fw-bold');\n\n                        // Mark element to avoid processing again.\n                        el.data('reloading', true);\n                        reloadNeeded = true;\n\n                    } else {\n                        // --- COUNTING ---\n                        const m = Math.floor(diff / 60);\n                        const s = diff % 60;\n                        const timeString = m + 'm ' + (s < 10 ? '0' : '') + s + 's';\n\n                        // Logic: Check if label \"Next collection...\" should be hidden.\n                        // If data-no-label attribute exists, use empty string.\n                        const showLabel = !el.attr('data-no-label');\n                        const label = (showLabel && strings.label) ? strings.label + ' ' : '';\n\n                        el.text(label + timeString);\n                    }\n                });\n\n                // If any timer finished, schedule page reload.\n                if (reloadNeeded) {\n                    setTimeout(() => {\n                        location.reload();\n                    }, 1500); // Wait 1.5 seconds before reloading.\n                }\n            };\n\n            // Start loop (1 second).\n            window.phTimerInterval = setInterval(updateTimers, 1000);\n            // Run immediately.\n            updateTimers();\n        }\n    };\n});\n"],"names":["define","$","init","strings","window","phTimerInterval","updateTimers","now","Math","floor","Date","reloadNeeded","each","el","this","data","deadline","parseInt","attr","isNaN","diff","text","ready","removeClass","addClass","s","timeString","label","setTimeout","location","reload","setInterval"],"mappings":";;;;;;;AAsBAA,gCAAO,CAAC,WAAW,SAASC,SACjB,CACHC,KAAM,SAASC,YAEPC,OAAOC,6BAKLC,aAAe,WACXC,IAAMC,KAAKC,MAAMC,KAAKH,MAAQ,SAChCI,cAAe,EAEnBV,EAAE,aAAaW,MAAK,iBACVC,GAAKZ,EAAEa,SAETD,GAAGE,KAAK,0BAINC,SAAWC,SAASJ,GAAGK,KAAK,qBAC9BC,MAAMH,uBAIJI,KAAOJ,SAAWT,OACpBa,MAAQ,EAERP,GAAGQ,KAAKlB,QAAQmB,OAChBT,GAAGU,YAAY,cAAcC,SAAS,wBAGtCX,GAAGE,KAAK,aAAa,GACrBJ,cAAe,MAEZ,OAGGc,EAAIL,KAAO,GACXM,WAFIlB,KAAKC,MAAMW,KAAO,IAEL,MAAQK,EAAI,GAAK,IAAM,IAAMA,EAAI,IAKlDE,OADad,GAAGK,KAAK,kBACCf,QAAQwB,MAASxB,QAAQwB,MAAQ,IAAM,GAEnEd,GAAGQ,KAAKM,MAAQD,gBAKpBf,cACAiB,YAAW,KACPC,SAASC,WACV,OAKX1B,OAAOC,gBAAkB0B,YAAYzB,aAAc,KAEnDA"}