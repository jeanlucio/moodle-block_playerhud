{"version":3,"file":"timers.min.js","sources":["../src/timers.js"],"sourcesContent":["/**\n * Timer logic for PlayerHUD Block.\n *\n * @module     block_playerhud/timers\n * @copyright  2026 Jean Lúcio\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function($) {\n    return {\n        init: function(strings) {\n            // Evita rodar múltiplos intervalos se o init for chamado várias vezes\n            if (window.phTimerInterval) {\n                return;\n            }\n\n            // Função de atualização\n            var updateTimers = function() {\n                var now = Math.floor(Date.now() / 1000);\n                var reloadNeeded = false;\n\n                $('.ph-timer').each(function() {\n                    var el = $(this);\n                    // Se já estiver marcado para recarregar, ignora\n                    if (el.data('reloading')) {\n                        return;\n                    }\n\n                    var deadline = parseInt(el.attr('data-deadline'));\n                    if (isNaN(deadline)) {\n                        return;\n                    }\n\n                    var diff = deadline - now;\n\n                    if (diff <= 0) {\n                        // --- TEMPO ACABOU ---\n                        el.text(strings.ready);\n                        el.removeClass('text-muted').addClass('text-success fw-bold');\n\n                        // Marca o elemento para não processar de novo\n                        el.data('reloading', true);\n                        reloadNeeded = true;\n\n                    } else {\n                        // --- CONTANDO ---\n                        var m = Math.floor(diff / 60);\n                        var s = diff % 60;\n                        var timeString = m + 'm ' + (s < 10 ? '0' : '') + s + 's';\n\n                        // Lógica Atualizada: Verifica se deve esconder o rótulo \"Próxima coleta...\"\n                        // Se o atributo data-no-label existir, usamos string vazia.\n                        var showLabel = !el.attr('data-no-label');\n                        var label = (showLabel && strings.label) ? strings.label + ' ' : '';\n\n                        el.text(label + timeString);\n                    }\n                });\n\n                // Se algum timer acabou, agenda o reload da página\n                if (reloadNeeded) {\n                    setTimeout(function() {\n                        location.reload();\n                    }, 1500); // Espera 1.5 segundos antes de recarregar\n                }\n            };\n\n            // Inicia o loop (1 segundo)\n            window.phTimerInterval = setInterval(updateTimers, 1000);\n            // Roda imediatamente\n            updateTimers();\n        }\n    };\n});\n"],"names":["define","$","init","strings","window","phTimerInterval","updateTimers","now","Math","floor","Date","reloadNeeded","each","el","this","data","deadline","parseInt","attr","isNaN","diff","text","ready","removeClass","addClass","s","timeString","label","setTimeout","location","reload","setInterval"],"mappings":";;;;;;;AAOAA,gCAAO,CAAC,WAAW,SAASC,SACjB,CACHC,KAAM,SAASC,aAEPC,OAAOC,qBAKPC,aAAe,eACXC,IAAMC,KAAKC,MAAMC,KAAKH,MAAQ,KAC9BI,cAAe,EAEnBV,EAAE,aAAaW,MAAK,eACZC,GAAKZ,EAAEa,UAEPD,GAAGE,KAAK,kBAIRC,SAAWC,SAASJ,GAAGK,KAAK,sBAC5BC,MAAMH,eAINI,KAAOJ,SAAWT,OAElBa,MAAQ,EAERP,GAAGQ,KAAKlB,QAAQmB,OAChBT,GAAGU,YAAY,cAAcC,SAAS,wBAGtCX,GAAGE,KAAK,aAAa,GACrBJ,cAAe,MAEZ,KAGCc,EAAIL,KAAO,GACXM,WAFIlB,KAAKC,MAAMW,KAAO,IAEL,MAAQK,EAAI,GAAK,IAAM,IAAMA,EAAI,IAKlDE,OADad,GAAGK,KAAK,kBACCf,QAAQwB,MAASxB,QAAQwB,MAAQ,IAAM,GAEjEd,GAAGQ,KAAKM,MAAQD,kBAKpBf,cACAiB,YAAW,WACPC,SAASC,WACV,OAKX1B,OAAOC,gBAAkB0B,YAAYzB,aAAc,KAEnDA"}