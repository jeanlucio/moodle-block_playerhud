{"version":3,"file":"manage_drops.min.js","sources":["../src/manage_drops.js"],"sourcesContent":["/* global bootstrap */\n// Importando core/copy_to_clipboard para que os bot√µes com data-action funcionem automaticamente\ndefine(['jquery', 'core/notification', 'core/copy_to_clipboard'], function($, Notification) {\n\n    /**\n     * Manage Drops module.\n     *\n     * @module     block_playerhud/manage_drops\n     * @copyright  2026 Jean L√∫cio\n     * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n     */\n    return {\n        /**\n         * Initialize the module.\n         *\n         * @param {Object} config The configuration object passed from PHP.\n         */\n        init: function(config) {\n            var currentItem = config.item;\n            var langStrings = config.strings;\n            var currentDropCode = 0;\n\n            // Elementos DOM (Cacheados como jQuery objects para consist√™ncia).\n            var $inputCode = $('#finalCode');\n            var $previewBox = $('#previewContainer');\n            var $groupTextLink = $('#textInputGroup');\n            var $inputLinkText = $('#customText');\n            var $groupCardOptions = $('#cardCustomOptions');\n            var $inputBtnText = $('#customBtnText');\n            var $inputBtnEmoji = $('#customBtnEmoji');\n\n            // Move modal para o body.\n            $('#codeGenModal').appendTo('body');\n\n            /**\n             * Atualiza o preview e o c√≥digo gerado no modal.\n             */\n            var updateGenerator = function() {\n                var modeRadio = $('input[name=\"codeMode\"]:checked');\n                var mode = modeRadio.length ? modeRadio.val() : 'card';\n\n                var param = isNaN(currentDropCode) ? 'code=' + currentDropCode : 'id=' + currentDropCode;\n                var code = '[PLAYERHUD_DROP ' + param + ']';\n                var previewHtml = '';\n\n                // Visibilidade dos grupos\n                if (mode === 'text') {\n                    $groupTextLink.show();\n                    $groupCardOptions.hide();\n\n                    var linkTxt = ($inputLinkText.val() && $inputLinkText.val().trim()) ?\n                        $inputLinkText.val().trim() : langStrings.defaultText;\n\n                    code = '[PLAYERHUD_DROP ' + param + ' mode=text text=\"' + linkTxt + '\"]';\n\n                    // MUDAN√áA: Classes Bootstrap em vez de style inline\n                    previewHtml = '<a href=\"#\" onclick=\"return false;\" ' +\n                        'class=\"text-primary fw-bold text-decoration-underline\">' + linkTxt + '</a>';\n\n                } else if (mode === 'image') {\n                    $groupTextLink.hide();\n                    $groupCardOptions.hide();\n\n                    code = '[PLAYERHUD_DROP ' + param + ' mode=image]';\n\n                    // MUDAN√áA: Uso das novas classes CSS .ph-gen-*\n                    var imgContent = currentItem.isImage ?\n                        '<img src=\"' + currentItem.url + '\" class=\"ph-gen-img-lg\" alt=\"\">' :\n                        '<span class=\"ph-gen-emoji-lg\" aria-hidden=\"true\">' + currentItem.content + '</span>';\n\n                    // Wrapper com classe\n                    previewHtml = '<div class=\"ph-gen-preview-wrapper-img\">' +\n                        imgContent + '</div>';\n\n                } else {\n                    // Mode Card\n                    $groupTextLink.hide();\n                    $groupCardOptions.show();\n\n                    // ... (l√≥gica de texto/emoji do bot√£o permanece igual) ...\n                    var userTxt = ($inputBtnText.val() && $inputBtnText.val().trim()) ? $inputBtnText.val().trim() : '';\n                    var userEmo = ($inputBtnEmoji.val() && $inputBtnEmoji.val().trim()) ? $inputBtnEmoji.val().trim() : '';\n                    var previewTxt = userTxt || langStrings.takeBtn;\n                    var previewEmo = userEmo || 'üñê';\n\n                    var extraAttrs = '';\n                    if (userTxt !== '') {\n                        extraAttrs += ' button_text=\"' + userTxt + '\"';\n                    }\n                    if (userEmo !== '') {\n                        extraAttrs += ' button_emoji=\"' + userEmo + '\"';\n                    }\n\n                    code = '[PLAYERHUD_DROP ' + param + extraAttrs + ']';\n\n                    // HTML do √çcone no Card (Tamb√©m limpo de estilos inline complexos)\n                    // Note que usamos classes utilit√°rias ou herdamos o estilo do card\n                    // MUDAN√áA: Substitu√≠mos style=\"...\" pela classe .ph-icon-contain criada no CSS\n                    var iconHtml = currentItem.isImage ?\n                        '<img src=\"' + currentItem.url + '\" class=\"ph-icon-contain\" alt=\"\">' :\n                        '<div style=\"font-size:2.5em; line-height:1;\">' + currentItem.content + '</div>';\n                    // Nota: Mantive um style m√≠nimo acima apenas para garantir o fit dentro do container flex de 60px do card,\n                    // eslint-disable-next-line max-len\n                    // pois criar classes para cada div interna pode ser excessivo, mas o ideal seria .ph-card-icon-container img {} no CSS.\n\n                    var btnContent = previewTxt;\n                    if (previewEmo) {\n                        btnContent = '<span aria-hidden=\"true\" class=\"me-1\">' + previewEmo + '</span> ' + previewTxt;\n                    }\n\n                    // MUDAN√áA: Removido style=\"width: 160px...\" e adicionada classe ph-gen-preview-real-card\n                    previewHtml = '<div class=\"ph-gen-preview-real-card card p-2 border shadow-sm\">' +\n                        '<span class=\"badge bg-info text-dark rounded-pill position-absolute\" ' +\n                        'style=\"top:5px; right:5px; font-size:0.7rem;\">' + langStrings.yours + '</span>' +\n                        '<div class=\"mb-2 d-flex align-items-center justify-content-center\" style=\"height:60px;\">' +\n                        iconHtml + '</div>' +\n                        '<strong class=\"d-block mb-2 text-truncate\" style=\"font-size:0.9rem;\">' +\n                        currentItem.name + '</strong>' +\n                        '<button class=\"btn btn-primary btn-sm w-100 shadow-sm\">' + btnContent + '</button>' +\n                        '</div>';\n                }\n\n                $inputCode.val(code);\n                $previewBox.html(previewHtml);\n            };\n\n            /**\n             * Handler para mudan√ßas nos inputs do gerador.\n             *\n             * @param {Event} e Evento.\n             */\n            var handleChange = function(e) {\n                var $target = $(e.target);\n                if ($target.hasClass('js-mode-trigger') ||\n                    $target.is('#customText') ||\n                    $target.is('#customBtnText') ||\n                    $target.is('#customBtnEmoji')) {\n                    updateGenerator();\n                }\n            };\n\n            // --- 1. L√ìGICA DE A√á√ïES EM MASSA ---\n\n            // \"Selecionar Todos\"\n            $('#ph-select-all').on('change', function() {\n                var isChecked = $(this).is(':checked');\n                $('.ph-bulk-check').prop('checked', isChecked).trigger('change');\n            });\n\n            // Habilitar/Desabilitar bot√£o\n            $('body').on('change', '.ph-bulk-check, #ph-select-all', function() {\n                var count = $('.ph-bulk-check:checked').length;\n                var $btn = $('#ph-btn-bulk-delete');\n\n                if (count > 0) {\n                    $btn.removeClass('disabled').removeAttr('disabled');\n                    var btnText = langStrings.delete_n_items.replace('%d', count);\n                    $btn.html('<i class=\"fa fa-trash\"></i> ' + btnText);\n                } else {\n                    $btn.addClass('disabled').attr('disabled', 'disabled');\n                    $btn.html('<i class=\"fa fa-trash\"></i> ' + langStrings.delete_selected);\n                }\n            });\n\n            // Confirma√ß√£o Bulk Delete (Com Delega√ß√£o de Evento)\n            $('body').on('click', '#ph-btn-bulk-delete', function(e) {\n                e.preventDefault();\n                var count = $('.ph-bulk-check:checked').length;\n                if (count === 0) {\n                    return;\n                }\n\n                Notification.confirm(\n                    langStrings.confirm_title,\n                    langStrings.confirm_bulk,\n                    langStrings.yes,\n                    langStrings.cancel,\n                    function() {\n                        $('#bulk-action-form').submit();\n                    }\n                );\n            });\n\n            // --- 2. LISTENERS GERAIS ---\n\n            $('body').on('click', function(e) {\n                var $target = $(e.target);\n\n                // A. Delete √önico\n                var $deleteBtn = $target.closest('.js-delete-btn');\n                if ($deleteBtn.length) {\n                    e.preventDefault();\n                    Notification.confirm(\n                        langStrings.confirm_title,\n                        $deleteBtn.attr('data-confirm-msg'),\n                        langStrings.yes,\n                        langStrings.cancel,\n                        function() {\n                            window.location.href = $deleteBtn.attr('href');\n                        }\n                    );\n                    return;\n                }\n\n                // B. Abrir Modal Gerador\n                var $trigger = $target.closest('.js-open-gen-modal');\n                if ($trigger.length) {\n                    e.preventDefault();\n                    currentDropCode = $trigger.attr('data-dropcode');\n\n                    // Reset Inputs\n                    $('#modeCard').prop('checked', true);\n                    $inputLinkText.val('');\n                    $inputBtnText.val('');\n                    $inputBtnEmoji.val('');\n\n                    updateGenerator();\n\n                    var modalEl = document.getElementById('codeGenModal');\n                    if (modalEl) {\n                        if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {\n                            bootstrap.Modal.getOrCreateInstance(modalEl).show();\n                        } else {\n                            $(modalEl).modal('show');\n                        }\n                    }\n                }\n            });\n\n            // Listeners de Input\n            $('body').on('change input', handleChange);\n// --- 3. COPY TO CLIPBOARD MANUAL (Fallback robusto) ---\n            $('body').on('click', '.js-copy-code', function(e) {\n                e.preventDefault();\n                var $btn = $(this);\n                var text = $btn.attr('data-clipboard-text');\n\n                if (text && navigator.clipboard) {\n                    // eslint-disable-next-line promise/always-return\n                    navigator.clipboard.writeText(text).then(function() {\n                        // Feedback Visual\n                        var originalHtml = $btn.html();\n                        var originalWidth = $btn.outerWidth(); // Fixa largura para n√£o pular\n\n                        // Estado de Sucesso\n                        $btn.css('width', originalWidth + 'px');\n                        $btn.removeClass('btn-outline-secondary').addClass('btn-success');\n                        $btn.html('<i class=\"fa fa-check\"></i> ' + langStrings.gen_copied);\n\n                        // Restaura ap√≥s 2 segundos\n                        setTimeout(function() {\n                            $btn.html(originalHtml);\n                            $btn.removeClass('btn-success').addClass('btn-outline-secondary');\n                            $btn.css('width', '');\n                        }, 2000);\n\n                    }).catch(function(err) {\n                        // Em caso de erro (ex: permiss√£o), loga no console mas n√£o quebra a UI\n                        // eslint-disable-next-line no-console\n                        console.error('Clipboard error:', err);\n                        Notification.alert('Erro', 'N√£o foi poss√≠vel copiar automaticamente.', 'OK');\n                    });\n                }\n            });\n        }\n    };\n});\n"],"names":["define","$","Notification","init","config","currentItem","item","langStrings","strings","currentDropCode","$inputCode","$previewBox","$groupTextLink","$inputLinkText","$groupCardOptions","$inputBtnText","$inputBtnEmoji","appendTo","updateGenerator","modeRadio","mode","length","val","param","isNaN","code","previewHtml","show","hide","linkTxt","trim","defaultText","isImage","url","content","userTxt","userEmo","previewTxt","takeBtn","previewEmo","extraAttrs","iconHtml","btnContent","yours","name","html","on","isChecked","this","is","prop","trigger","count","$btn","removeClass","removeAttr","btnText","delete_n_items","replace","addClass","attr","delete_selected","e","preventDefault","confirm","confirm_title","confirm_bulk","yes","cancel","submit","$target","target","$deleteBtn","closest","window","location","href","$trigger","modalEl","document","getElementById","bootstrap","Modal","getOrCreateInstance","modal","hasClass","text","navigator","clipboard","writeText","then","originalHtml","originalWidth","outerWidth","css","gen_copied","setTimeout","catch","err","console","error","alert"],"mappings":"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"}