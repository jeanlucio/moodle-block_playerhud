{"version":3,"file":"manage_drops.min.js","sources":["../src/manage_drops.js"],"sourcesContent":["/* global bootstrap */\ndefine(['jquery', 'core/notification'], function($, Notification) {\n\n    return {\n        init: function(config) {\n            $('#codeGenModal').appendTo('body');\n\n            var currentItem = config.item;\n            var langStrings = config.strings;\n            var currentDropCode = 0;\n\n            // Elementos\n            var inputCode = document.getElementById('finalCode');\n            // Var inputText = document.getElementById('customText'); // Removido pois é redeclarado abaixo como inputLinkText\n            var previewBox = document.getElementById('previewContainer');\n\n            // Inputs de Personalização\n            var groupTextLink = document.getElementById('textInputGroup'); // Grupo do modo Texto\n            var inputLinkText = document.getElementById('customText');// Input do modo Texto\n\n            var groupCardOptions = document.getElementById('cardCustomOptions'); // Grupo do modo Card (NOVO)\n            var inputBtnText = document.getElementById('customBtnText');// Input Texto Botão\n            var inputBtnEmoji = document.getElementById('customBtnEmoji');// Input Emoji Botão\n\n            // --- Listeners ---\n            document.body.addEventListener('click', function(e) {\n                // Delete\n                var deleteBtn = e.target.closest('.js-delete-btn');\n                if (deleteBtn) {\n                    e.preventDefault();\n                    Notification.confirm(\n                        langStrings.confirm_title,\n                        deleteBtn.getAttribute('data-confirm-msg'),\n                        langStrings.yes,\n                        langStrings.cancel,\n                        function() {\n                            window.location.href = deleteBtn.getAttribute('href');\n                        }\n                    );\n                    return;\n                }\n\n                // Open Modal\n                var trigger = e.target.closest('.js-open-gen-modal');\n                if (trigger) {\n                    e.preventDefault();\n                    currentDropCode = trigger.getAttribute('data-dropcode');\n\n                    // Reset inputs\n                    var radioCard = document.getElementById('modeCard');\n                    if (radioCard) {\n                        radioCard.checked = true;\n                    }\n\n                    if (inputLinkText) {\n                        inputLinkText.value = langStrings.defaultText;\n                    }\n                    if (inputBtnText) {\n                        inputBtnText.value = langStrings.takeBtn;\n                    }\n                    if (inputBtnEmoji) {\n                        inputBtnEmoji.value = '';\n                    }\n\n                    updateGenerator();\n\n                    var el = document.getElementById('codeGenModal');\n                    if (el) {\n                        if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {\n                            bootstrap.Modal.getOrCreateInstance(el).show();\n                        } else {\n                            $(el).modal('show');\n                        }\n                    }\n                }\n\n                // Copy\n                if (e.target.closest('#copyFinalCode')) {\n                    if (inputCode) {\n                        inputCode.select();\n                        inputCode.setSelectionRange(0, 99999);\n                        document.execCommand('copy');\n                        var fb = document.getElementById('copyFeedback');\n                        if (fb) {\n                            fb.style.display = 'inline-block';\n                            setTimeout(function() {\n                                fb.style.display = 'none';\n                            }, 3000);\n                        }\n                    }\n                }\n            });\n\n            // Listeners de Input para atualização em tempo real\n            document.body.addEventListener('change', handleChange);\n            document.body.addEventListener('input', handleChange);\n\n            /**\n             * Handles input changes to update preview.\n             *\n             * @param {Event} e The event object.\n             */\n            function handleChange(e) {\n                if (e.target.classList.contains('js-mode-trigger') ||\n                    e.target.id === 'customText' ||\n                    e.target.id === 'customBtnText' ||\n                    e.target.id === 'customBtnEmoji') {\n                    updateGenerator();\n                }\n            }\n\n            /**\n             * Updates the generator preview and code.\n             */\n            // eslint-disable-next-line complexity\n            function updateGenerator() {\n                var modeRadio = document.querySelector('input[name=\"codeMode\"]:checked');\n                var mode = modeRadio ? modeRadio.value : 'card';\n\n                var param = isNaN(currentDropCode) ? 'code=' + currentDropCode : 'id=' + currentDropCode;\n                var code = '[PLAYERHUD_DROP ' + param + ']'; // Base code\n                var previewHtml = '';\n\n                // Visibilidade dos grupos de input\n                if (groupTextLink) {\n                    groupTextLink.style.display = (mode === 'text') ? 'block' : 'none';\n                }\n                if (groupCardOptions) {\n                    groupCardOptions.style.display = (mode === 'card') ? 'block' : 'none';\n                }\n\n                // --- MODO TEXTO ---\n                if (mode === 'text') {\n                    var linkTxt = inputLinkText.value.trim() || langStrings.defaultText;\n                    code = '[PLAYERHUD_DROP ' + param + ' mode=text text=\"' + linkTxt + '\"]';\n                    previewHtml = '<a href=\"#\" onclick=\"return false;\" class=\"text-primary fw-bold text-decoration-underline\">' +\n                        linkTxt + '</a>';\n                    // eslint-disable-next-line brace-style\n                    }\n                // --- MODO IMAGEM ---\n                else if (mode === 'image') {\n                    code = '[PLAYERHUD_DROP ' + param + ' mode=image]';\n\n                    var imgContent = currentItem.isImage\n                        ? '<img src=\"' + currentItem.url + '\" style=\"width:50px; height:50px; object-fit:contain;\" alt=\"\">'\n                        : '<span style=\"font-size:40px;\" aria-hidden=\"true\">' + currentItem.content + '</span>';\n\n                    previewHtml = '<div style=\"cursor:pointer; filter: drop-shadow(0 4px 2px rgba(0,0,0,0.1));\">' +\n                        imgContent + '</div>';\n                // eslint-disable-next-line brace-style\n                }\n                // --- MODO CARD (Padrão) ---\n                else {\n                    // Captura personalizações\n                    var btnTxt = (inputBtnText && inputBtnText.value.trim()) ? inputBtnText.value.trim() : langStrings.takeBtn;\n                    var btnEmo = (inputBtnEmoji && inputBtnEmoji.value.trim()) ? inputBtnEmoji.value.trim() : '';\n\n                    // Constrói shortcode com atributos opcionais\n                    var extraAttrs = '';\n                    if (btnTxt !== langStrings.takeBtn) {\n                        extraAttrs += ' button_text=\"' + btnTxt + '\"';\n                    }\n                    if (btnEmo !== '') {\n                        extraAttrs += ' button_emoji=\"' + btnEmo + '\"';\n                    }\n\n                    code = '[PLAYERHUD_DROP ' + param + extraAttrs + ']';\n\n                    // Constrói Prévia Fiel (Usando a estrutura do Filtro e a nova classe CSS)\n                    var iconHtml = currentItem.isImage\n                        ? '<img src=\"' + currentItem.url + '\" alt=\"\">' // CSS controla tamanho\n                        : '<div style=\"font-size:2.5em; line-height:1;\">' + currentItem.content + '</div>';\n\n                    // HTML do Botão\n                    var btnContent = btnTxt;\n                    if (btnEmo) {\n                        btnContent = '<span aria-hidden=\"true\" class=\"me-1\">' + btnEmo + '</span> ' + btnTxt;\n                    }\n\n                    previewHtml =\n                    '<div class=\"ph-gen-preview-real-card\">' +\n                        '<span class=\"badge bg-info text-dark rounded-pill position-absolute\" ' +\n                        'style=\"top:5px; right:5px; font-size:0.7rem;\">' + langStrings.yours + '</span>' +\n                        '<div class=\"mb-2 d-flex align-items-center justify-content-center\" style=\"height:60px;\">' +\n                            iconHtml +\n                        '</div>' +\n                        '<strong class=\"d-block mb-2 text-truncate\" style=\"font-size:0.9rem;\">' + currentItem.name + '</strong>' +\n                        '<button class=\"btn btn-primary btn-sm w-100 shadow-sm\">' + btnContent + '</button>' +\n                    '</div>';\n                }\n\n                if (inputCode) {\n                    inputCode.value = code;\n                }\n                if (previewBox) {\n                    previewBox.innerHTML = previewHtml;\n                }\n            }\n        }\n    };\n});\n"],"names":["define","$","Notification","init","config","appendTo","currentItem","item","langStrings","strings","currentDropCode","inputCode","document","getElementById","previewBox","groupTextLink","inputLinkText","groupCardOptions","inputBtnText","inputBtnEmoji","handleChange","e","target","classList","contains","id","updateGenerator","modeRadio","querySelector","mode","value","param","isNaN","code","previewHtml","style","display","linkTxt","trim","defaultText","isImage","url","content","btnTxt","takeBtn","btnEmo","extraAttrs","iconHtml","btnContent","yours","name","innerHTML","body","addEventListener","deleteBtn","closest","preventDefault","confirm","confirm_title","getAttribute","yes","cancel","window","location","href","trigger","radioCard","checked","el","bootstrap","Modal","getOrCreateInstance","show","modal","select","setSelectionRange","execCommand","fb","setTimeout"],"mappings":"AACAA,sCAAO,CAAC,SAAU,sBAAsB,SAASC,EAAGC,oBAEzC,CACHC,KAAM,SAASC,QACXH,EAAE,iBAAiBI,SAAS,YAExBC,YAAcF,OAAOG,KACrBC,YAAcJ,OAAOK,QACrBC,gBAAkB,EAGlBC,UAAYC,SAASC,eAAe,aAEpCC,WAAaF,SAASC,eAAe,oBAGrCE,cAAgBH,SAASC,eAAe,kBACxCG,cAAgBJ,SAASC,eAAe,cAExCI,iBAAmBL,SAASC,eAAe,qBAC3CK,aAAeN,SAASC,eAAe,iBACvCM,cAAgBP,SAASC,eAAe,2BAgFnCO,aAAaC,IACdA,EAAEC,OAAOC,UAAUC,SAAS,oBACZ,eAAhBH,EAAEC,OAAOG,IACO,kBAAhBJ,EAAEC,OAAOG,IACO,mBAAhBJ,EAAEC,OAAOG,KACTC,2BAQCA,sBACDC,UAAYf,SAASgB,cAAc,kCACnCC,KAAOF,UAAYA,UAAUG,MAAQ,OAErCC,MAAQC,MAAMtB,iBAAmB,QAAUA,gBAAkB,MAAQA,gBACrEuB,KAAO,mBAAqBF,MAAQ,IACpCG,YAAc,MAGdnB,gBACAA,cAAcoB,MAAMC,QAAoB,SAATP,KAAmB,QAAU,QAE5DZ,mBACAA,iBAAiBkB,MAAMC,QAAoB,SAATP,KAAmB,QAAU,QAItD,SAATA,KAAiB,KACbQ,QAAUrB,cAAcc,MAAMQ,QAAU9B,YAAY+B,YACxDN,KAAO,mBAAqBF,MAAQ,oBAAsBM,QAAU,KACpEH,YAAc,8FACVG,QAAU,YAIb,GAAa,UAATR,KAAkB,CACvBI,KAAO,mBAAqBF,MAAQ,eAMpCG,YAAc,iFAJG5B,YAAYkC,QACvB,aAAelC,YAAYmC,IAAM,iEACjC,oDAAsDnC,YAAYoC,QAAU,WAGjE,aAIhB,KAEGC,OAAUzB,cAAgBA,aAAaY,MAAMQ,OAAUpB,aAAaY,MAAMQ,OAAS9B,YAAYoC,QAC/FC,OAAU1B,eAAiBA,cAAcW,MAAMQ,OAAUnB,cAAcW,MAAMQ,OAAS,GAGtFQ,WAAa,GACbH,SAAWnC,YAAYoC,UACvBE,YAAc,iBAAmBH,OAAS,KAE/B,KAAXE,SACAC,YAAc,kBAAoBD,OAAS,KAG/CZ,KAAO,mBAAqBF,MAAQe,WAAa,QAG7CC,SAAWzC,YAAYkC,QACrB,aAAelC,YAAYmC,IAAM,YACjC,gDAAkDnC,YAAYoC,QAAU,SAG1EM,WAAaL,OACbE,SACAG,WAAa,yCAA2CH,OAAS,WAAaF,QAGlFT,YACA,4JAEuD1B,YAAYyC,MAFnE,kGAIQF,SAJR,8EAM8EzC,YAAY4C,KAN1F,mEAOgEF,WAPhE,kBAWArC,YACAA,UAAUmB,MAAQG,MAElBnB,aACAA,WAAWqC,UAAYjB,aA1K/BtB,SAASwC,KAAKC,iBAAiB,SAAS,SAAShC,OAEzCiC,UAAYjC,EAAEC,OAAOiC,QAAQ,qBAC7BD,iBACAjC,EAAEmC,sBACFtD,aAAauD,QACTjD,YAAYkD,cACZJ,UAAUK,aAAa,oBACvBnD,YAAYoD,IACZpD,YAAYqD,QACZ,WACIC,OAAOC,SAASC,KAAOV,UAAUK,aAAa,eAOtDM,QAAU5C,EAAEC,OAAOiC,QAAQ,yBAC3BU,QAAS,CACT5C,EAAEmC,iBACF9C,gBAAkBuD,QAAQN,aAAa,qBAGnCO,UAAYtD,SAASC,eAAe,YACpCqD,YACAA,UAAUC,SAAU,GAGpBnD,gBACAA,cAAcc,MAAQtB,YAAY+B,aAElCrB,eACAA,aAAaY,MAAQtB,YAAYoC,SAEjCzB,gBACAA,cAAcW,MAAQ,IAG1BJ,sBAEI0C,GAAKxD,SAASC,eAAe,gBAC7BuD,KACyB,oBAAdC,WAA6BA,UAAUC,MAC9CD,UAAUC,MAAMC,oBAAoBH,IAAII,OAExCvE,EAAEmE,IAAIK,MAAM,YAMpBpD,EAAEC,OAAOiC,QAAQ,mBACb5C,UAAW,CACXA,UAAU+D,SACV/D,UAAUgE,kBAAkB,EAAG,OAC/B/D,SAASgE,YAAY,YACjBC,GAAKjE,SAASC,eAAe,gBAC7BgE,KACAA,GAAG1C,MAAMC,QAAU,eACnB0C,YAAW,WACPD,GAAG1C,MAAMC,QAAU,SACpB,UAOnBxB,SAASwC,KAAKC,iBAAiB,SAAUjC,cACzCR,SAASwC,KAAKC,iBAAiB,QAASjC"}