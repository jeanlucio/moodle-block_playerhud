{"version":3,"file":"manage_drops.min.js","sources":["../src/manage_drops.js"],"sourcesContent":["/* global bootstrap */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['jquery', 'core/notification', 'core/copy_to_clipboard'], function($, Notification) {\n\n    /**\n     * Manage Drops module.\n     *\n     * @module     block_playerhud/manage_drops\n     * @copyright  2026 Jean L√∫cio\n     * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n     */\n    return {\n        init: function(config) {\n            const currentItem = config.item;\n            const langStrings = config.strings;\n            let currentDropCode = 0;\n\n            // DOM Elements.\n            const $inputCode = $('#finalCode');\n            const $previewBox = $('#previewContainer');\n            const $groupTextLink = $('#textInputGroup');\n            const $inputLinkText = $('#customText');\n            const $groupCardOptions = $('#cardCustomOptions');\n            const $inputBtnText = $('#customBtnText');\n            const $inputBtnEmoji = $('#customBtnEmoji');\n\n            $('#ph-codegen-modal').appendTo('body');\n\n            /**\n             * Updates the preview and generated code in the modal.\n             */\n            const updateGenerator = () => {\n                const modeRadio = $('input[name=\"codeMode\"]:checked');\n                const mode = modeRadio.length ? modeRadio.val() : 'card';\n\n                const param = isNaN(currentDropCode) ? 'code=' + currentDropCode : 'id=' + currentDropCode;\n                let code = '[PLAYERHUD_DROP ' + param + ']';\n                let previewHtml = '';\n\n                // Handle visibility and preview generation based on selected mode.\n                if (mode === 'text') {\n                    $groupTextLink.show();\n                    $groupCardOptions.hide();\n\n                    const linkTxt = ($inputLinkText.val() && $inputLinkText.val().trim()) ?\n                        $inputLinkText.val().trim() : langStrings.defaultText;\n\n                    code = '[PLAYERHUD_DROP ' + param + ' mode=text text=\"' + linkTxt + '\"]';\n\n                    // eslint-disable-next-line max-len\n                    previewHtml = `<a href=\"#\" onclick=\"return false;\" class=\"text-primary fw-bold text-decoration-underline\">${linkTxt}</a>`;\n\n                } else if (mode === 'image') {\n                    $groupTextLink.hide();\n                    $groupCardOptions.hide();\n\n                    code = '[PLAYERHUD_DROP ' + param + ' mode=image]';\n\n                    const imgContent = currentItem.isImage ?\n                        `<img src=\"${currentItem.url}\" class=\"ph-gen-img-lg\" alt=\"\">` :\n                        `<span class=\"ph-gen-emoji-lg\" aria-hidden=\"true\">${currentItem.content}</span>`;\n\n                    previewHtml = `<div class=\"ph-gen-preview-wrapper-img\">${imgContent}</div>`;\n\n                } else {\n                    // Card Mode.\n                    $groupTextLink.hide();\n                    $groupCardOptions.show();\n\n                    const userTxt = ($inputBtnText.val() && $inputBtnText.val().trim()) ? $inputBtnText.val().trim() : '';\n                    const userEmo = ($inputBtnEmoji.val() && $inputBtnEmoji.val().trim()) ? $inputBtnEmoji.val().trim() : '';\n                    const previewTxt = userTxt || langStrings.takeBtn;\n                    const previewEmo = userEmo || 'üñê';\n\n                    let extraAttrs = '';\n                    if (userTxt !== '') {\n                        extraAttrs += ' button_text=\"' + userTxt + '\"';\n                    }\n                    if (userEmo !== '') {\n                        extraAttrs += ' button_emoji=\"' + userEmo + '\"';\n                    }\n\n                    code = '[PLAYERHUD_DROP ' + param + extraAttrs + ']';\n\n                    const iconHtml = currentItem.isImage ?\n                        `<img src=\"${currentItem.url}\" class=\"ph-icon-contain\" alt=\"\">` :\n                        `<div class=\"fs-1 lh-1\">${currentItem.content}</div>`;\n\n                    let btnContent = previewTxt;\n                    if (previewEmo) {\n                        btnContent = `<span aria-hidden=\"true\" class=\"me-1\">${previewEmo}</span> ${previewTxt}`;\n                    }\n\n                    previewHtml = `\n                        <div class=\"ph-gen-preview-real-card card p-2 border shadow-sm position-relative\">\n                            <span class=\"badge bg-info text-dark rounded-pill ph-badge-preview-corner\">${langStrings.yours}</span>\n                            <div class=\"mb-2 d-flex align-items-center justify-content-center ph-h-60\">\n                                ${iconHtml}\n                            </div>\n                            <strong class=\"d-block mb-2 text-truncate ph-fs-09\">${currentItem.name}</strong>\n                            <button class=\"btn btn-primary btn-sm w-100 shadow-sm\">${btnContent}</button>\n                        </div>`;\n                }\n\n                $inputCode.val(code);\n                $previewBox.html(previewHtml);\n            };\n\n            /**\n             * Handles input changes to update the generator preview.\n             *\n             * @param {Event} e The change/input event.\n             */\n            const handleChange = (e) => {\n                const $target = $(e.target);\n                if ($target.hasClass('js-mode-trigger') ||\n                    $target.is('#customText') ||\n                    $target.is('#customBtnText') ||\n                    $target.is('#customBtnEmoji')) {\n                    updateGenerator();\n                }\n            };\n\n            // Event Listeners.\n            $('#ph-select-all').on('change', function() {\n                const isChecked = $(this).is(':checked');\n                $('.ph-bulk-check').prop('checked', isChecked).trigger('change');\n            });\n\n            $('body').on('change', '.ph-bulk-check, #ph-select-all', function() {\n                const count = $('.ph-bulk-check:checked').length;\n                const $btn = $('#ph-btn-bulk-delete');\n\n                if (count > 0) {\n                    $btn.removeClass('disabled').removeAttr('disabled');\n                    const btnText = langStrings.delete_n_items.replace('%d', count);\n                    $btn.html('<i class=\"fa fa-trash\"></i> ' + btnText);\n                } else {\n                    $btn.addClass('disabled').attr('disabled', 'disabled');\n                    $btn.html('<i class=\"fa fa-trash\"></i> ' + langStrings.delete_selected);\n                }\n            });\n\n            $('body').on('click', '#ph-btn-bulk-delete', function(e) {\n                e.preventDefault();\n                const count = $('.ph-bulk-check:checked').length;\n                if (count === 0) {\n                    return;\n                }\n\n                Notification.confirm(\n                    langStrings.confirm_title,\n                    langStrings.confirm_bulk,\n                    langStrings.yes,\n                    langStrings.cancel,\n                    function() {\n                        $('#bulk-action-form').submit();\n                    }\n                );\n            });\n\n            $('body').on('click', function(e) {\n                const $target = $(e.target);\n\n                // A. Single Delete Action.\n                const $deleteBtn = $target.closest('.js-delete-btn');\n                if ($deleteBtn.length) {\n                    e.preventDefault();\n                    Notification.confirm(\n                        langStrings.confirm_title,\n                        $deleteBtn.attr('data-confirm-msg'),\n                        langStrings.yes,\n                        langStrings.cancel,\n                        function() {\n                            window.location.href = $deleteBtn.attr('href');\n                        }\n                    );\n                    return;\n                }\n\n                // B. Open Generator Modal.\n                const $trigger = $target.closest('.js-open-gen-modal');\n                if ($trigger.length) {\n                    e.preventDefault();\n                    currentDropCode = $trigger.attr('data-dropcode');\n\n                    $('#modeCard').prop('checked', true);\n                    $inputLinkText.val('');\n                    $inputBtnText.val('');\n                    $inputBtnEmoji.val('');\n\n                    updateGenerator();\n\n                    const modalEl = document.getElementById('ph-codegen-modal');\n                    if (modalEl) {\n                        if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {\n                            bootstrap.Modal.getOrCreateInstance(modalEl).show();\n                        } else {\n                            $(modalEl).modal('show');\n                        }\n                    }\n                }\n            });\n\n            $('body').on('change input', handleChange);\n\n            // Copy to Clipboard with Visual Feedback.\n            $('body').on('click', '.js-copy-code', function(e) {\n                e.preventDefault();\n                const $btn = $(this);\n                const text = $btn.attr('data-clipboard-text');\n\n                if (text && navigator.clipboard) {\n                    // eslint-disable-next-line promise/always-return\n                    navigator.clipboard.writeText(text).then(function() {\n                        const originalHtml = $btn.html();\n                        const originalWidth = $btn.outerWidth();\n\n                        $btn.css('width', (originalWidth + 25) + 'px');\n                        $btn.removeClass('btn-outline-secondary').addClass('btn-success');\n                        $btn.html('<i class=\"fa fa-check\"></i> ' + langStrings.gen_copied);\n\n                        setTimeout(function() {\n                            $btn.html(originalHtml);\n                            $btn.removeClass('btn-success').addClass('btn-outline-secondary');\n                            $btn.css('width', '');\n                        }, 2000);\n\n                    }).catch(function(err) {\n                        // eslint-disable-next-line no-console\n                        console.error('Clipboard error:', err);\n                        Notification.alert('Error', 'Unable to copy to clipboard.', 'OK');\n                    });\n                }\n            });\n        }\n    };\n});\n"],"names":["define","$","Notification","init","config","currentItem","item","langStrings","strings","currentDropCode","$inputCode","$previewBox","$groupTextLink","$inputLinkText","$groupCardOptions","$inputBtnText","$inputBtnEmoji","appendTo","updateGenerator","modeRadio","mode","length","val","param","isNaN","code","previewHtml","show","hide","linkTxt","trim","defaultText","imgContent","isImage","url","content","userTxt","userEmo","previewTxt","takeBtn","previewEmo","extraAttrs","iconHtml","btnContent","yours","name","html","on","isChecked","this","is","prop","trigger","count","$btn","removeClass","removeAttr","btnText","delete_n_items","replace","addClass","attr","delete_selected","e","preventDefault","confirm","confirm_title","confirm_bulk","yes","cancel","submit","$target","target","$deleteBtn","closest","window","location","href","$trigger","modalEl","document","getElementById","bootstrap","Modal","getOrCreateInstance","modal","hasClass","text","navigator","clipboard","writeText","then","originalHtml","originalWidth","outerWidth","css","gen_copied","setTimeout","catch","err","console","error","alert"],"mappings":"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"}