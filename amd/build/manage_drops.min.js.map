{"version":3,"file":"manage_drops.min.js","sources":["../src/manage_drops.js"],"sourcesContent":["define(['jquery', 'core/notification'], function($) {\n\n    return {\n        init: function(config) {\n            // Configurações passadas pelo PHP\n            var currentItem = config.item;\n            var langStrings = config.strings;\n            var currentDropCode = 0;\n\n            // Elementos do DOM\n            var inputCode = document.getElementById('finalCode');\n            var inputText = document.getElementById('customText');\n            var textGroup = document.getElementById('textInputGroup');\n            var previewBox = document.getElementById('previewContainer');\n            var copyFeedback = document.getElementById('copyFeedback');\n\n            // --- Listener Global (Event Delegation) ---\n            document.body.addEventListener('click', function(e) {\n\n                // A. Abrir Modal\n                var trigger = e.target.closest('.js-open-gen-modal');\n                if (trigger) {\n                    e.preventDefault();\n                    currentDropCode = trigger.getAttribute('data-dropcode');\n\n                    // Reset do formulário\n                    var radioCard = document.getElementById('modeCard');\n                    if (radioCard) {\n                        radioCard.checked = true;\n                    }\n\n                    if (inputText) {\n                        inputText.value = langStrings.defaultText;\n                        textGroup.style.display = 'none';\n                    }\n\n                    updateGenerator();\n\n                    // Abrir Modal (Bootstrap 5 Nativo)\n                    var el = document.getElementById('codeGenModal');\n                    if (el) {\n                        // Verifica se o bootstrap está disponível globalmente ou via AMD shim\n                        // Fallback seguro para Moodle 4.x\n                        // eslint-disable-next-line no-undef\n                        if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {\n                            // eslint-disable-next-line no-undef\n                            var modal = bootstrap.Modal.getOrCreateInstance(el);\n                            modal.show();\n                        } else {\n                            // Fallback jQuery (se o tema não expuser o bootstrap global)\n                            $(el).modal('show');\n                        }\n                    }\n                }\n\n                // B. Botão Copiar\n                if (e.target.closest('#copyFinalCode')) {\n                    if (inputCode) {\n                        inputCode.select();\n                        inputCode.setSelectionRange(0, 99999);\n                        document.execCommand('copy');\n\n                        if (copyFeedback) {\n                            copyFeedback.style.display = 'inline-block';\n                            setTimeout(function() {\n                                copyFeedback.style.display = 'none';\n                            }, 3000);\n                        }\n                    }\n                }\n            });\n\n            // --- Listener de Mudanças (Radio Buttons e Input) ---\n            document.body.addEventListener('change', function(e) {\n                if (e.target.classList.contains('js-mode-trigger')) {\n                    updateGenerator();\n                }\n            });\n\n            if (inputText) {\n                inputText.addEventListener('input', updateGenerator);\n                inputText.addEventListener('focus', function() {\n                    if (this.value === langStrings.defaultText) {\n                        this.value = '';\n                        updateGenerator();\n                    }\n                });\n            }\n\n            // --- Função Principal de Geração ---\n            /**\n             *\n             */\n            function updateGenerator() {\n                var modeRadio = document.querySelector('input[name=\"codeMode\"]:checked');\n                var mode = modeRadio ? modeRadio.value : 'card';\n\n                // Lógica Híbrida: ID ou Hash\n                // Se não for número (ex: 3C815F), usa 'code='. Se for número (15), usa 'id='.\n                var param = isNaN(currentDropCode) ? 'code=' + currentDropCode : 'id=' + currentDropCode;\n\n                var code = '[PLAYERHUD_DROP ' + param + ']';\n                var previewHtml = '';\n\n                if (mode === 'text') {\n                    if (textGroup) {\n                        textGroup.style.display = 'block';\n                    }\n\n                    var displayTxt = inputText.value.trim();\n                    if (!displayTxt) {\n                        displayTxt = langStrings.defaultText;\n                    }\n\n                    var codeTxt = inputText.value.trim() || langStrings.defaultText;\n\n                    code = '[PLAYERHUD_DROP ' + param + ' mode=text text=\"' + codeTxt + '\"]';\n\n                    // eslint-disable-next-line max-len\n                    previewHtml = '<a href=\"#\" onclick=\"return false;\" class=\"text-primary\" style=\"text-decoration:underline;\">' + displayTxt + '</a>';\n\n                } else if (mode === 'image') {\n                    if (textGroup) {\n                        textGroup.style.display = 'none';\n                    }\n                    code = '[PLAYERHUD_DROP ' + param + ' mode=image]';\n\n                    var iconHtml = currentItem.isImage\n                        ? '<img src=\"' + currentItem.url + '\" style=\"width:50px; height:50px; object-fit:contain;\" alt=\"\">'\n                        : '<span style=\"font-size:40px;\" aria-hidden=\"true\">' + currentItem.content + '</span>';\n\n                    // eslint-disable-next-line max-len\n                    previewHtml = '<div style=\"cursor:pointer; filter: drop-shadow(0 4px 2px rgba(0,0,0,0.1)); text-align:center;\">' + iconHtml + '</div>';\n\n                } else {\n                    // Modo Card (Padrão)\n                    if (textGroup) {\n                        textGroup.style.display = 'none';\n                    }\n\n                    var iconHtmlCard = currentItem.isImage\n                        ? '<img src=\"' + currentItem.url + '\" style=\"width:40px; height:40px; object-fit:contain;\" alt=\"\">'\n                        : '<span style=\"font-size:30px;\" aria-hidden=\"true\">' + currentItem.content + '</span>';\n\n                    previewHtml =\n                    // eslint-disable-next-line max-len\n                    '<div style=\"padding: 15px; border-radius: 8px; display: inline-flex; align-items: center; gap: 15px; border: 2px dashed #0f6cbf; background: #f8f9fa;\">' +\n                        '<div>' + iconHtmlCard + '</div>' +\n                        '<div class=\"text-start\">' +\n                            '<strong>' + currentItem.name + '</strong> ' +\n                            '<span class=\"badge bg-info rounded-pill text-dark\">' + langStrings.yours + '</span><br>' +\n                            '<small class=\"text-muted\">' + currentItem.xp + '</small>' +\n                        '</div>' +\n                        '<button class=\"btn btn-primary btn-sm ms-3\">' + langStrings.takeBtn + '</button>' +\n                    '</div>';\n                }\n\n                if (inputCode) {\n                    inputCode.value = code;\n                }\n                if (previewBox) {\n                    previewBox.innerHTML = previewHtml;\n                }\n            }\n        }\n    };\n});"],"names":["define","$","init","config","currentItem","item","langStrings","strings","currentDropCode","inputCode","document","getElementById","inputText","textGroup","previewBox","copyFeedback","updateGenerator","modeRadio","querySelector","mode","value","param","isNaN","code","previewHtml","style","display","displayTxt","trim","defaultText","isImage","url","content","name","yours","xp","takeBtn","innerHTML","body","addEventListener","e","trigger","target","closest","preventDefault","getAttribute","radioCard","checked","el","bootstrap","Modal","getOrCreateInstance","show","modal","select","setSelectionRange","execCommand","setTimeout","classList","contains","this"],"mappings":"AAAAA,sCAAO,CAAC,SAAU,sBAAsB,SAASC,SAEtC,CACHC,KAAM,SAASC,YAEPC,YAAcD,OAAOE,KACrBC,YAAcH,OAAOI,QACrBC,gBAAkB,EAGlBC,UAAYC,SAASC,eAAe,aACpCC,UAAYF,SAASC,eAAe,cACpCE,UAAYH,SAASC,eAAe,kBACpCG,WAAaJ,SAASC,eAAe,oBACrCI,aAAeL,SAASC,eAAe,yBA+ElCK,sBACDC,UAAYP,SAASQ,cAAc,kCACnCC,KAAOF,UAAYA,UAAUG,MAAQ,OAIrCC,MAAQC,MAAMd,iBAAmB,QAAUA,gBAAkB,MAAQA,gBAErEe,KAAO,mBAAqBF,MAAQ,IACpCG,YAAc,MAEL,SAATL,KAAiB,CACbN,YACAA,UAAUY,MAAMC,QAAU,aAG1BC,WAAaf,UAAUQ,MAAMQ,OAC5BD,aACDA,WAAarB,YAAYuB,aAK7BN,KAAO,mBAAqBF,MAAQ,qBAFtBT,UAAUQ,MAAMQ,QAAUtB,YAAYuB,aAEgB,KAGpEL,YAAc,+FAAiGG,WAAa,YAEzH,GAAa,UAATR,KAAkB,CACrBN,YACAA,UAAUY,MAAMC,QAAU,QAE9BH,KAAO,mBAAqBF,MAAQ,eAOpCG,YAAc,oGALCpB,YAAY0B,QACrB,aAAe1B,YAAY2B,IAAM,iEACjC,oDAAsD3B,YAAY4B,QAAU,WAG4C,aAE3H,CAECnB,YACAA,UAAUY,MAAMC,QAAU,QAO9BF,YAEA,gKANmBpB,YAAY0B,QACzB,aAAe1B,YAAY2B,IAAM,iEACjC,oDAAsD3B,YAAY4B,QAAU,WAIlF,yCAGqB5B,YAAY6B,KAHjC,gEAIgE3B,YAAY4B,MAJ5E,wCAKuC9B,YAAY+B,GALnD,6DAOqD7B,YAAY8B,QAPjE,kBAWA3B,YACAA,UAAUW,MAAQG,MAElBT,aACAA,WAAWuB,UAAYb,aAhJ/Bd,SAAS4B,KAAKC,iBAAiB,SAAS,SAASC,OAGzCC,QAAUD,EAAEE,OAAOC,QAAQ,yBAC3BF,QAAS,CACTD,EAAEI,iBACFpC,gBAAkBiC,QAAQI,aAAa,qBAGnCC,UAAYpC,SAASC,eAAe,YACpCmC,YACAA,UAAUC,SAAU,GAGpBnC,YACAA,UAAUQ,MAAQd,YAAYuB,YAC9BhB,UAAUY,MAAMC,QAAU,QAG9BV,sBAGIgC,GAAKtC,SAASC,eAAe,mBAC7BqC,MAIyB,oBAAdC,WAA6BA,UAAUC,MAElCD,UAAUC,MAAMC,oBAAoBH,IAC1CI,YAGNnD,EAAE+C,IAAIK,MAAM,QAMpBb,EAAEE,OAAOC,QAAQ,mBACblC,YACAA,UAAU6C,SACV7C,UAAU8C,kBAAkB,EAAG,OAC/B7C,SAAS8C,YAAY,QAEjBzC,eACAA,aAAaU,MAAMC,QAAU,eAC7B+B,YAAW,WACP1C,aAAaU,MAAMC,QAAU,SAC9B,UAOnBhB,SAAS4B,KAAKC,iBAAiB,UAAU,SAASC,GAC1CA,EAAEE,OAAOgB,UAAUC,SAAS,oBAC5B3C,qBAIJJ,YACAA,UAAU2B,iBAAiB,QAASvB,iBACpCJ,UAAU2B,iBAAiB,SAAS,WAC5BqB,KAAKxC,QAAUd,YAAYuB,mBACtBT,MAAQ,GACbJ"}