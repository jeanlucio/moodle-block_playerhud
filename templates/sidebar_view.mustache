{{! @template block_playerhud/sidebar_view }}
<div class="block_playerhud_sidebar p-2">
    
    {{! 1. PROFILE & AVATAR }}
    <div class="text-center mb-2">
        <div class="mb-2 ph-sidebar-avatar-container">
            {{{userpicture}}}
        </div>
        <div class="fw-bold text-truncate px-1" title="{{username}}">
            {{username}}
        </div>
    </div>

    {{! 2. STATS }}
    <div class="d-flex justify-content-between align-items-center mb-1 small text-muted px-1">
        <span class="badge {{level_class}} border">{{#str}} level, block_playerhud {{/str}} {{level}}</span>
        <span>{{xp}}</span>
    </div>

    <div class="ph-progress-container mb-3">
        <div class="progress-bar ph-progress-bar {{level_class}}" role="progressbar" 
             style="width: {{progress}}%;"
             aria-valuenow="{{progress}}" aria-valuemin="0" aria-valuemax="100">
             <span class="visually-hidden">{{progress}}% {{#str}} completed, core {{/str}}</span>
        </div>
    </div>

    {{! 3. MASTER PANEL (Agora posicionado entre a barra e o grid) }}
    {{#isteacher}}
    <div class="mb-3">
        <a href="{{{manageurl}}}" class="btn btn-outline-dark btn-sm w-100 shadow-sm fw-bold">
            <i class="fa fa-cogs" aria-hidden="true"></i> {{#str}} master_panel, block_playerhud {{/str}}
        </a>
    </div>
    {{/isteacher}}

    {{! 4. ACTIONS GRID}}
    <div class="ph-sidebar-grid mb-4 {{level_class}}">
        
        {{! A. ColeÃ§Ã£o }}
        <a href="{{viewurl}}" 
           class="btn btn-ph-level-border shadow-sm" 
           data-bs-toggle="tooltip" data-bs-placement="top" 
           title="{{#str}} openbackpack, block_playerhud {{/str}}">
            <span aria-hidden="true">ğŸ’</span>
        </a>

        {{! B. Loja }}
        <a href="{{url_shop}}" 
           class="btn btn-ph-level-border shadow-sm" 
           data-bs-toggle="tooltip" data-bs-placement="top" 
           title="{{#str}} tab_shop, block_playerhud {{/str}}">
            <span aria-hidden="true">âš–ï¸</span>
        </a>

        {{! C. MissÃµes }}
        <a href="{{url_quests}}" 
           class="btn btn-ph-level-border shadow-sm" 
           data-bs-toggle="tooltip" data-bs-placement="top" 
           title="{{#str}} tab_quests, block_playerhud {{/str}}">
            <span aria-hidden="true">ğŸ“œ</span>
        </a>

        {{! D. HistÃ³ria }}
        <a href="{{url_story}}" 
           class="btn btn-ph-level-border shadow-sm" 
           data-bs-toggle="tooltip" data-bs-placement="bottom" 
           title="{{#str}} tab_chapters, block_playerhud {{/str}}">
            <span aria-hidden="true">ğŸ“–</span>
        </a>

        {{! E. Ranking }}
        {{#ranking}}
        <a href="{{url}}" 
           class="btn btn-ph-level-border shadow-sm" 
           data-bs-toggle="tooltip" data-bs-placement="bottom" 
           title="#{{rank}} - {{label}}">
            <span aria-hidden="true">ğŸ†</span>
        </a>
        {{/ranking}}

        {{! F. Sair }}
        <a href="{{url_disable}}" 
           class="btn btn-ph-level-border shadow-sm js-disable-hud"
           data-bs-toggle="tooltip" data-bs-placement="bottom" 
           data-confirm-msg="{{str_confirm_msg}}"
           title="{{str_disable_gamification}}"
           aria-label="{{str_disable_gamification}}">
            <span aria-hidden="true" class="text-danger">
                <i class="fa fa-power-off"></i>
            </span>
        </a>

    </div>

    {{! 5. LATEST ITEMS (Stash no final) }}
    <div class="ph-stash-wrapper {{^has_items}}d-none{{/has_items}}">
        <small class="text-muted text-uppercase fw-bold border-bottom d-block mb-2 pb-1" style="font-size: 0.7rem;">
            {{#str}} latest_items, block_playerhud {{/str}}
        </small>
        <div class="ph-sidebar-stash mt-1 justify-content-center">
            {{#items}}
            <div class="ph-mini-item ph-item-trigger" 
                 role="button" 
                 tabindex="0"
                 data-name="{{name}}"
                 data-xp="{{xp}}"
                 data-image="{{image}}"
                 data-isimage="{{isimage}}"
                 data-date="{{date}}"
                 data-timestamp="{{timestamp}}"
                 title="{{name}}">
                 
                 <div class="d-none ph-item-description-content">{{{description}}}</div>

                 {{#isimage}}
                    <img src="{{image}}" alt="{{name}}">
                 {{/isimage}}
                 {{^isimage}}
                    <span class="ph-emoji" aria-hidden="true">{{image}}</span>
                 {{/isimage}}
            </div>
            {{/items}}
        </div>
    </div>

</div>
