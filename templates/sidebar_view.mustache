{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template block_playerhud/sidebar_view
    @package block_playerhud
    @copyright 2026 Jean L√∫cio
    @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later

    @example context (json):
    {
        "userpicture": "<img src='user.jpg'>",
        "username": "Student Name",
        "level_class": "ph-lvl-tier-1",
        "level": "1 / 10",
        "xp": "100 / 500 XP",
        "viewurl": "#",
        "progress": 20,
        "isteacher": true,
        "manageurl": "#",
        "has_items": true,
        "items": [
            {
                "name": "Potion",
                "xp": "50 XP",
                "isimage": false,
                "image": "üß™",
                "description": "Mana restore"
            }
        ],
        "ranking": {
            "url": "#",
            "tooltip": "Rank #1",
            "label": "Leaderboard"
        },
        "url_disable": "#",
        "str_confirm_msg": "Sure?",
        "str_disable_gamification": "Disable"
    }
}}
<div class="block_playerhud_sidebar p-2">

    {{! 1. PROFILE & AVATAR }}
    <div class="text-center mb-2">
        <div class="mb-2 ph-sidebar-avatar-container">
            {{{userpicture}}}
        </div>
        <div class="fw-bold text-truncate px-1" title="{{username}}">
            {{username}}
        </div>
    </div>

    {{! 2. STATS }}
    <div class="d-flex justify-content-between align-items-center mb-1 small text-muted px-1">
        <span class="badge {{level_class}} border">{{#str}} level, block_playerhud {{/str}} {{level}}</span>
        <div class="d-flex align-items-center gap-2">
                <span>{{xp}}</span>
                <a href="{{viewurl}}&tab=rules" class="ph-help-trigger" 
                title="{{#str}} help_btn, block_playerhud {{/str}}" aria-label="{{#str}} help_btn, block_playerhud {{/str}}">
                    <i class="fa fa-question-circle" aria-hidden="true"></i>
                </a>
            </div>
    </div>

    <div class="progress ph-progress-container mb-3">
        <div class="progress-bar ph-progress-bar {{level_class}}" role="progressbar"
             style="width: {{progress}}%;"
             aria-valuenow="{{progress}}" aria-valuemin="0" aria-valuemax="100">
             <span class="ph-progress-text">{{progress}}%</span>
        </div>
    </div>

    {{! 3. MASTER PANEL }}
    {{#isteacher}}
    <div class="mb-3">
        <a href="{{{manageurl}}}" class="btn btn-outline-dark btn-sm w-100 shadow-sm fw-bold">
            <i class="fa fa-cogs me-2" aria-hidden="true"></i> {{#str}} master_panel, block_playerhud {{/str}}
        </a>
    </div>
    {{/isteacher}}

    {{! 4. ACTIONS GRID }}
    <div class="ph-sidebar-grid mb-4 {{level_class}}">

        {{! A. Collection / Backpack }}
        <a href="{{viewurl}}"
           class="btn btn-ph-level-border shadow-sm"
           data-bs-toggle="tooltip" data-bs-placement="top"
           title="{{#str}} openbackpack, block_playerhud {{/str}}"
           aria-label="{{#str}} openbackpack, block_playerhud {{/str}}">
            <span aria-hidden="true">üéí</span>
        </a>

        {{! B. Ranking }}
        {{#ranking}}
        <a href="{{url}}"
           class="btn btn-ph-level-border shadow-sm"
           data-bs-toggle="tooltip" data-bs-placement="bottom"
           title="{{tooltip}}"
           aria-label="{{label}}">
            <span aria-hidden="true">üèÜ</span>
        </a>
        {{/ranking}}

        {{! C. Exit }}
        <a href="{{url_disable}}"
           class="btn btn-ph-level-border shadow-sm js-disable-hud"
           data-bs-toggle="tooltip" data-bs-placement="bottom"
           data-confirm-msg="{{str_confirm_msg}}"
           title="{{str_disable_gamification}}"
           aria-label="{{str_disable_gamification}}">
            <span aria-hidden="true" class="text-danger">
                 <i class="fa fa-power-off"></i>
            </span>
        </a>

    </div>

    {{! 5. LATEST ITEMS }}
    <div class="ph-stash-wrapper {{^has_items}}d-none{{/has_items}}">
        <small class="text-muted text-uppercase fw-bold border-bottom d-block mb-2 pb-1 ph-text-xs">
            {{#str}} latest_items, block_playerhud {{/str}}
        </small>
        <div class="ph-sidebar-stash mt-1 justify-content-center">
            {{#items}}
            <div class="ph-mini-item ph-item-trigger"
                 role="button"
                 tabindex="0"
                 data-name="{{name}}"
                 data-xp="{{xp}}"
                 data-image="{{image}}"
                 data-isimage="{{isimage}}"
                 data-date="{{date}}"
                 data-timestamp="{{timestamp}}"
                 title="{{name}}"
                 aria-label="{{name}}">

                 <div class="d-none ph-item-description-content">{{{description}}}</div>

                 {{#isimage}}
                    <img src="{{image}}" alt="" class="ph-mini-item-img">
                 {{/isimage}}
                 {{^isimage}}
                    <span class="ph-emoji" aria-hidden="true">{{image}}</span>
                 {{/isimage}}
            </div>
            {{/items}}
        </div>
    </div>

</div>