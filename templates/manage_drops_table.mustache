{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template block_playerhud/manage_drops_table

    Manage drops table template.

    @package    block_playerhud
    @copyright  2026 Jean LÃºcio <jeanlucio@gmail.com>
    @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later

    Example context (json):
    {
        "url_course": "#",
        "str_back_course": "Back to Course",
        "is_image": true,
        "media_url": "http://example.com/image.png",
        "str_managing": "Managing Drops for:",
        "item_name": "Excalibur Sword",
        "url_library": "#",
        "str_back_lib": "Back to Library",
        "url_new_drop": "#",
        "str_new_drop": "New Drop Location",
        "summary_text": "You have 2 drops configured.",
        "base_url": "#",
        "sesskey": "12345",
        "str_select_all": "Select all",
        "headers": {
            "name": { "url": "#", "label": "Location", "icon_class": "fa-sort" },
            "qty": { "url": "#", "label": "Qty", "icon_class": "fa-sort" },
            "time": { "url": "#", "label": "Time", "icon_class": "fa-sort" }
        },
        "str_col_gen": "Code Generator",
        "str_actions": "Actions",
        "drops": [
            {
                "id": 1,
                "counter": 1,
                "name": "Library",
                "is_infinite": false,
                "maxusage": 5,
                "is_immediate": false,
                "respawntime_fmt": "1h",
                "full_default_code": "[PLAYERHUD_DROP code=ABC]",
                "display_code": "ABC",
                "str_quick_copy": "Copy",
                "str_gen_title": "Customize",
                "url_edit": "#",
                "str_edit": "Edit",
                "url_delete": "#",
                "str_delete": "Delete",
                "confirm_msg": "Sure?"
            }
        ],
        "str_select": "Select",
        "str_empty_drops": "No drops found",
        "str_delete_selected": "Delete selected",
        "str_help_code": "Help text here"
    }
}}
<div class="d-flex align-items-center mb-4 border-bottom pb-3">
    <a href="{{url_course}}" class="btn btn-outline-secondary me-3 shadow-sm">
        <i class="fa fa-arrow-left" aria-hidden="true"></i> {{str_back_course}}
    </a>
    <div class="d-flex align-items-center">
        {{#is_image}}
            <img src="{{media_url}}" class="ph-header-img" alt="">
        {{/is_image}}
        {{^is_image}}
            <span class="ph-header-emoji" aria-hidden="true">{{{media_content}}}</span>
        {{/is_image}}
        <div>
            <small class="text-muted text-uppercase fw-bold">{{str_managing}}</small>
            <h2 class="m-0">{{item_name}}</h2>
        </div>
    </div>

    <div class="ms-auto d-flex gap-3">
        <a href="{{url_library}}" class="btn btn-outline-dark shadow-sm">
            <i class="fa fa-book" aria-hidden="true"></i> {{str_back_lib}}
        </a>
        <a href="{{url_new_drop}}" class="btn btn-success shadow-sm ms-2">
            <i class="fa fa-plus" aria-hidden="true"></i> {{str_new_drop}}
        </a>
    </div>
</div>

<div class="alert alert-light border shadow-sm d-flex align-items-center mb-3">
    <i class="fa fa-map-signs text-info me-2 fa-lg" aria-hidden="true"></i>
    <span class="fw-bold text-dark">{{summary_text}}</span>
</div>

<form action="{{base_url}}" method="post" id="bulk-action-form">
    <input type="hidden" name="action" value="bulk_delete">
    <input type="hidden" name="sesskey" value="{{sesskey}}">

    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <table class="table table-hover table-striped mb-0 align-middle">
                <thead class="bg-light">
                    <tr>
                        <th scope="col" class="ph-col-select">
                            <span class="accesshide">{{str_select_all}}</span>
                            <input type="checkbox" id="ph-select-all" class="form-check-input" title="{{str_select_all}}">
                        </th>
                        <th scope="col" class="ph-col-sm">N.</th>

                        <th scope="col">
                            <a href="{{headers.name.url}}" class="text-dark text-decoration-none fw-bold d-flex align-items-center">
                                {{headers.name.label}} <i class="fa {{headers.name.icon_class}} ms-1" aria-hidden="true"></i>
                            </a>
                        </th>
                        <th scope="col" class="ph-col-qty">
                            <a href="{{headers.qty.url}}" class="text-dark text-decoration-none fw-bold d-flex align-items-center">
                                {{headers.qty.label}} <i class="fa {{headers.qty.icon_class}} ms-1" aria-hidden="true"></i>
                            </a>
                        </th>
                        <th scope="col" class="ph-col-time">
                            <a href="{{headers.time.url}}" class="text-dark text-decoration-none fw-bold d-flex align-items-center">
                                {{headers.time.label}} <i class="fa {{headers.time.icon_class}} ms-1" aria-hidden="true"></i>
                            </a>
                        </th>

                        <th scope="col" class="ph-col-gen">{{str_col_gen}}</th>
                        <th scope="col" class="text-end ph-col-actions">{{str_actions}}</th>
                    </tr>
                </thead>
                <tbody>
                    {{#drops}}
                    <tr>
                        <td class="ph-col-select">
                            <label class="accesshide" for="chk-{{id}}">{{str_select}}</label>
                            <input type="checkbox" name="bulk_ids[]" value="{{id}}" id="chk-{{id}}" class="form-check-input ph-bulk-check">
                        </td>
                        <td class="align-middle text-muted small">{{counter}}</td>
                        <td class="align-middle fw-bold">{{{name}}}</td>
                        <td class="align-middle">
                            {{#is_infinite}}
                                <span class="badge bg-success text-white"><i class="fa fa-infinity" aria-hidden="true"></i> {{str_infinite}}</span>
                            {{/is_infinite}}
                            {{^is_infinite}}
                                <span class="badge bg-light text-dark border border-secondary">Max: {{maxusage}}</span>
                            {{/is_infinite}}
                        </td>
                        <td class="align-middle">
                            {{#is_immediate}}
                                <span class="badge bg-light text-dark border shadow-sm"><i class="fa fa-bolt text-warning" aria-hidden="true"></i> {{str_immediate}}</span>
                            {{/is_immediate}}
                            {{^is_immediate}}
                                <span class="badge bg-warning text-dark border border-warning" title="{{respawntime}}s">
                                    <i class="fa fa-clock-o" aria-hidden="true"></i> {{respawntime_fmt}}
                                </span>
                            {{/is_immediate}}
                        </td>

                        <td class="align-middle text-nowrap">
                            <div class="d-flex gap-2 justify-content-start">
                                <button type="button" class="btn btn-outline-secondary btn-sm shadow-sm js-copy-code me-1"
                                        data-clipboard-text="{{full_default_code}}"
                                        title="{{str_quick_copy}}"
                                        aria-label="{{str_quick_copy}}">
                                    <i class="fa fa-copy" aria-hidden="true"></i> {{str_quick_copy}}
                                </button>

                                <button type="button" class="btn btn-outline-dark btn-sm js-open-gen-modal shadow-sm"
                                        data-dropcode="{{display_code}}"
                                        title="{{str_gen_title}}"
                                        aria-label="{{str_gen_title}}">
                                    <i class="fa fa-magic" aria-hidden="true"></i> {{str_gen_title}}
                                </button>
                            </div>
                        </td>

                        <td class="align-middle text-end">
                            <a href="{{url_edit}}" class="btn btn-sm btn-primary me-1 shadow-sm">
                                <i class="fa fa-pencil" aria-hidden="true"></i> {{str_edit}}
                            </a>
                            <a href="{{url_delete}}" class="btn btn-sm btn-danger shadow-sm js-delete-btn"
                               data-confirm-msg="{{confirm_msg}}">
                                <i class="fa fa-trash" aria-hidden="true"></i> {{str_delete}}
                            </a>
                        </td>
                    </tr>
                    {{/drops}}
                    {{^drops}}
                        <tr><td colspan="7" class="text-center p-3">{{str_empty_drops}}</td></tr>
                    {{/drops}}
                </tbody>
            </table>
        </div>
    </div>

    <div class="mt-3 mb-3">
        <button type="button" class="btn btn-danger shadow-sm disabled" id="ph-btn-bulk-delete" disabled>
            <i class="fa fa-trash" aria-hidden="true"></i> {{str_delete_selected}}
        </button>
    </div>

    <div class="alert alert-info mt-3">
        {{str_help_code}}
    </div>
</form>

{{{modal_gen_html}}}
